<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì•ˆë””ì˜¥ ì²­ë…„ë¶€ ê²Œì„ â€“ Menu</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

<style>
  :root {
    --bg-panel: #fdfaf2;
    --border-dark: #3a2513;
    --accent: #c47a3f;
    --accent-dark: #8b4f26;
    --primary-btn: #4CAF50; /* ê²Œì„ì‹œì‘ ë²„íŠ¼ìš© ë…¹ìƒ‰ */
    --primary-dark: #2E7D32;
    --text-main: #3a2513;
  }

  * { box-sizing: border-box; }

  body {
    margin: 0; padding: 0; height: 100vh;
    display: flex; flex-direction: column;
    font-family: "Pretendard", system-ui, -apple-system, sans-serif;
    color: var(--text-main);
    /* [ê°œì„ ] ê²Œì„ ë¶„ìœ„ê¸°ì™€ ì´ì–´ì§€ëŠ” ë°°ê²½ ì ìš© */
    background: url("https://antiochapp.github.io/TrapGame/bg_sky.png") no-repeat center bottom;
    background-size: cover;
  }

  /* ë°°ê²½ ì˜¤ë²„ë ˆì´ (í…ìŠ¤íŠ¸ ê°€ë…ì„± í™•ë³´) */
  body::before {
    content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(255, 248, 235, 0.4); z-index: -1;
  }

  /* ìƒë‹¨ë°” */
  .top-bar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 16px; background: rgba(59, 38, 20, 0.95); color: #fbe8c4;
    font-size: 14px; border-bottom: 4px solid #1f130b; backdrop-filter: blur(4px);
  }

  .game-logo { display: flex; align-items: center; gap: 8px; font-weight: 800; letter-spacing: 0.05em; }
  .logo-pixel {
    width: 24px; height: 24px; border-radius: 4px; background: #f7cf70;
    border: 2px solid #fff; image-rendering: pixelated;
    background-image: url("pixel_cross.png"); background-size: cover;
  }

  .user-info { display: flex; align-items: center; gap: 10px; }
  .logout-btn {
    padding: 4px 8px; font-size: 11px; background: #d32f2f; color: white;
    border: 0; border-radius: 4px; cursor: pointer;
  }

  /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
  #menuWrapper { flex: 1; display: flex; justify-content: center; align-items: center; width: 100%; }
  
  .container {
    width: 90%; max-width: 400px;
    padding: 32px 24px;
    background: rgba(253, 250, 242, 0.95); /* ë°˜íˆ¬ëª… íŒ¨ë„ */
    border-radius: 16px;
    border: 4px solid var(--border-dark);
    box-shadow: 0 0 0 4px rgba(255,255,255,0.5), 0 12px 20px rgba(0,0,0,0.3);
    text-align: center;
    backdrop-filter: blur(5px);
  }

  h1 { font-size: 28px; font-weight: 900; margin: 0 0 8px; color: #3a2513; text-shadow: 2px 2px 0 rgba(0,0,0,0.1); }
  .sub { font-size: 13px; color: #7d6a4c; margin-bottom: 28px; font-weight: 600; }

  /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  .pixel-btn {
    width: 100%; padding: 16px; font-size: 18px; margin-bottom: 12px;
    border: 0; border-radius: 12px; color: #fff; cursor: pointer;
    font-weight: 800; transition: transform 0.1s;
    display: flex; justify-content: center; align-items: center; gap: 8px;
  }
  .pixel-btn:active { transform: translateY(3px); }

  /* [ê°œì„ ] ì‹œì‘ ë²„íŠ¼ ê°•ì¡° (ë…¹ìƒ‰) */
  .btn-start {
    background: var(--primary-btn);
    box-shadow: 0 5px 0 var(--primary-dark);
    font-size: 20px; padding: 18px;
  }
  .btn-start:active { box-shadow: 0 2px 0 var(--primary-dark); }

  /* [ê°œì„ ] ì¼ë°˜ ë²„íŠ¼ (ê°ˆìƒ‰/ì£¼í™©) */
  .btn-normal {
    background: var(--accent);
    box-shadow: 0 5px 0 var(--accent-dark);
  }
  .btn-normal:active { box-shadow: 0 2px 0 var(--accent-dark); }

  .version { margin-top: 24px; font-size: 11px; color: #9a8970; opacity: 0.7; }

  /* ë­í‚¹ ëª¨ë‹¬ */
  .modal-bg {
    display: none; position: fixed; top: 0; left: 0;
    width: 100%; height: 100%; background: rgba(0,0,0,0.6);
    justify-content: center; align-items: center; padding: 16px; z-index: 999;
    backdrop-filter: blur(3px);
  }
  .modal {
    width: 100%; max-width: 420px; background: var(--bg-panel);
    padding: 24px; border-radius: 14px; border: 4px solid var(--border-dark);
    box-shadow: 0 10px 0 #b79b76; text-align: center;
    max-height: 80vh; overflow-y: auto;
  }
  .rank-item {
    display: flex; justify-content: space-between; align-items: center;
    margin: 8px 0; padding: 10px 14px;
    background: #fff; border-radius: 8px; border: 2px solid #e0d8c8;
    font-size: 14px; text-align: left;
  }
  .rank-rank { font-weight: 900; color: var(--accent-dark); width: 40px; }
  .rank-info { flex: 1; }
  .rank-score { font-weight: bold; color: #d32f2f; }
  .msg { font-size: 12px; color: #888; display: block; margin-top: 2px; font-style: italic;}

  .close-btn {
    margin-top: 18px; padding: 12px 24px; background: #555;
    color: #fff; border-radius: 8px; cursor: pointer; border: 0;
    box-shadow: 0 4px 0 #333; font-weight: bold; width: 100%;
  }
</style>
</head>

<body>

<div class="top-bar">
  <div class="game-logo">
    <div class="logo-pixel"></div>
    <span>Disciple Run</span>
  </div>
  <div class="user-info">
    <span id="playerName" style="font-weight:bold;">Guest</span>
    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</div>

<div id="menuWrapper">
  <div class="container">
    <h1>ë©”ì¸ ë©”ë‰´</h1>
    <div class="sub">ANTIOCH HOLY SPARK RUN</div>

    <button class="pixel-btn btn-start" onclick="startGame()">
      <span>â–¶ ê²Œì„ ì‹œì‘</span>
    </button>
    
    <div style="display:flex; gap:10px;">
      <button class="pixel-btn btn-normal" onclick="openStore()">ğŸ›’ ìƒì </button>
      <button class="pixel-btn btn-normal" onclick="showRanking()">ğŸ† ë­í‚¹</button>
    </div>

    <div class="version">v1.1 Â· Antioch Youth</div>
  </div>
</div>

<div id="rankingModal" class="modal-bg">
  <div class="modal">
    <h2 style="margin-top:0;">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h2>
    <div id="rankingList"></div>
    <button class="close-btn" onclick="closeRanking()">ë‹«ê¸°</button>
  </div>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbzA10H2TuXRDXBXcttvHHR0Q1sOu8zGpYmrdGhfH-wBsl623k2ydwUkwL7wR8F90mC5Pg/exec";

  const name = localStorage.getItem("run_name");
  const id = localStorage.getItem("run_id");

  if (!id) {
    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    window.location.href = "/TrapGame/index.html";
  }

  document.getElementById("playerName").innerText = name || "Guest";

  function startGame() { window.location.href = "/TrapGame/game.html"; }
  function openStore() { window.location.href = "/TrapGame/store.html"; }
  
  function logout() {
    if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      localStorage.removeItem("run_id");
      localStorage.removeItem("run_name");
      window.location.href = "/TrapGame/index.html";
    }
  }

  // ì„œë²„ ë™ê¸°í™”
  async function refreshSave() {
    try {
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ type: "getSaveData", id })
      });
      const txt = await res.text();
      if (txt !== "fail") {
        localStorage.setItem("run_save", txt); // ë°›ì€ JSON ë¬¸ìì—´ ê·¸ëŒ€ë¡œ ì €ì¥
      }
    } catch (e) { console.warn("Sync Fail:", e); }
  }
  refreshSave();

  // ë­í‚¹ ë¶ˆëŸ¬ì˜¤ê¸°
  async function showRanking() {
    const modal = document.getElementById("rankingModal");
    modal.style.display = "flex";
    const listDiv = document.getElementById("rankingList");
    listDiv.innerHTML = "<p style='padding:20px;'>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";

    try {
      const res = await fetch(API_URL, { method: "POST", body: JSON.stringify({ type: "getRanking" }) });
      const txt = await res.text();
      const list = JSON.parse(txt);

      let html = "";
      if (list.length === 0) {
        html = "<p>ì•„ì§ ë“±ë¡ëœ ë­í‚¹ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
      } else {
        list.forEach((item, index) => {
          let rankIcon = (index + 1) + ".";
          if(index === 0) rankIcon = "ğŸ¥‡";
          if(index === 1) rankIcon = "ğŸ¥ˆ";
          if(index === 2) rankIcon = "ğŸ¥‰";

          html += `
            <div class="rank-item">
              <div class="rank-rank">${rankIcon}</div>
              <div class="rank-info">
                <div>${item.name}</div>
                <span class="msg">${item.message || "í•œë§ˆë”” ì—†ìŒ"}</span>
              </div>
              <div class="rank-score">${item.distance}m</div>
            </div>
          `;
        });
      }
      listDiv.innerHTML = html;
    } catch (e) {
      listDiv.innerHTML = "<p>ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨ :(</p>";
    }
  }

  function closeRanking() { document.getElementById("rankingModal").style.display = "none"; }
</script>

</body>
</html>
