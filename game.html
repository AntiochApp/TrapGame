<!DOCTYPE html>
<html lang="ko">
<head>
Â  <meta charset="UTF-8" />
Â  <title>Disciple Run â€“ Final Fixed Ver</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

Â  <style>
Â  Â  :root { --hud-bg: rgba(255, 248, 235, 0.9); --hud-border: #3a2513; --accent: #c47a3f; --panel-bg: #fdfaf2; }
Â  Â  * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }
Â  Â  html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; touch-action: none; font-family: "Pretendard", sans-serif; }
Â  Â Â 
Â  Â  #gameArea { position: relative; width: 100vw; height: 100vh; overflow: hidden; background: linear-gradient(#88c6ff 0%, #b7e3ff 45%, #f7f0d9 45%, #f0e0b0 100%); transition: filter 0.5s; }
Â  Â Â 
Â  Â  /* í•˜íœ˜ ìŠ¤í‚¬ ë°°ê²½ */
Â  Â  #gameArea.sand-bg { background: url('Sand.png') no-repeat center/cover !important; }
Â  Â  #gameArea.sand-bg .bg-layer { opacity: 0; transition: opacity 0.5s; }

Â  Â  /* í™”ë©´ íš¨ê³¼ */
Â  Â  #gameArea.fever-mode { filter: sepia(40%) saturate(180%) hue-rotate(-5deg); }
Â  Â  #gameArea.sandstorm-mode { filter: sepia(80%) brightness(0.9); }
Â  Â  #gameArea.shake-screen { animation: screenShake 0.2s infinite; }
Â  Â  @keyframes screenShake { 0% { transform: translate(0, 0); } 25% { transform: translate(-5px, 5px); } 50% { transform: translate(5px, -5px); } 75% { transform: translate(-5px, -5px); } 100% { transform: translate(0, 0); } }

Â  Â  #flashEffect { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; pointer-events: none; z-index: 200; transition: opacity 0.1s; }

Â  Â  /* ì „ì°¬: ë²ˆê°œ */
Â  Â  .jc-lightning-strike { position: absolute; width: 15px; height: 120vh; z-index: 89; pointer-events: none; box-shadow: 0 0 20px #fff, 0 0 40px yellow; transform-origin: top center; opacity: 0; mix-blend-mode: screen; background: #fff; }

Â  Â  /* ì „ì°¬ í•´ë¨¸ */
Â  Â  .hammer-skill { position: absolute; width: 400px; height: 400px; background: url('Hammer.png') no-repeat center/contain; z-index: 95; pointer-events: none; filter: drop-shadow(0 0 20px gold); transform: rotate(-45deg); }
Â  Â  .hammer-lightning { position: absolute; width: 4px; height: 100px; background: #fff; box-shadow: 0 0 10px cyan; pointer-events: none; z-index: 94; transform-origin: top center; animation: sparkFade 0.3s forwards; }
Â  Â  @keyframes sparkFade { 0% { opacity: 1; transform: scaleY(1); } 100% { opacity: 0; transform: scaleY(0); } }

Â  Â  /* ì§€ì€: ìŒê³„ ë° ë°°ê²½ */
Â  Â  .music-note { position: absolute; font-size: 40px; font-weight: bold; z-index: 65; pointer-events: none; text-shadow: 2px 2px 0 #fff; animation: noteFloat 1s infinite ease-in-out alternate; }
Â  Â  @keyframes noteFloat { from { transform: translateY(0); } to { transform: translateY(-15px); } }
Â  Â  .jieun-wave-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, rgba(255,0,150,0.2), rgba(0,204,255,0.2)); z-index: 4; pointer-events: none; opacity: 0; transition: opacity 1s; }

Â  Â  /* ë…¸ì—˜: ì˜¤ë¡œë¼ */
Â  Â  .noel-aura { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 140px; height: 140px; border-radius: 50%; background: radial-gradient(circle, rgba(255,215,0,0.4), transparent 70%); box-shadow: 0 0 50px gold; z-index: 49; pointer-events: none; animation: auraPulse 0.5s infinite alternate; }
Â  Â  @keyframes auraPulse { from { transform: translate(-50%, -50%) scale(1); opacity: 0.6; } to { transform: translate(-50%, -50%) scale(1.2); opacity: 1; } }

Â  Â  /* ì§€í˜œ: íëŸ¬ ë° ê¸°ë‘¥ */
Â  Â  .jihye-healer { position: absolute; width: 70px; height: 70px; background-image: url('Skill_JHA.png'); background-size: contain; background-repeat: no-repeat; z-index: 60; pointer-events: none; transition: left 1.5s ease-out, top 1.5s ease-out; filter: drop-shadow(0 0 15px gold); }
Â  Â  .holy-light-pillar { position: absolute; width: 100px; height: 100vh; background: linear-gradient(to bottom, transparent, rgba(255, 255, 200, 0.6), transparent); bottom: 0; transform: translateX(-50%); z-index: 59; pointer-events: none; animation: lightPillar 2.0s ease-out forwards; }
Â  Â  @keyframes lightPillar { 0% { opacity: 0; width: 0; } 20% { opacity: 1; width: 120px; } 80% { opacity: 1; width: 120px; } 100% { opacity: 0; width: 0; } }

Â  Â  /* í•˜íœ˜: ì¸í”¼ë‹ˆí‹° ìŠ¤í†¤ & ëª¨ë˜í­í’ */
Â  Â  .infinity-stone { position: absolute; width: 24px; height: 24px; border-radius: 50%; box-shadow: 0 0 15px currentColor; z-index: 65; pointer-events: none; border: 2px solid white; }
Â  Â  .sandstorm-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('noise.png'); background-color: rgba(194, 178, 128, 0.3); z-index: 85; pointer-events: none; opacity: 0; transition: opacity 0.5s; animation: sandMove 0.2s infinite linear; }
Â  Â  @keyframes sandMove { 0% { background-position: 0 0; } 100% { background-position: 100px 50px; } }
Â  Â  .dust-effect { position: absolute; width: 60px; height: 60px; background: radial-gradient(circle, #d2b48c, transparent); opacity: 0.8; border-radius: 50%; z-index: 80; animation: turnToDust 0.6s ease-out forwards; }
Â  Â  @keyframes turnToDust { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(2) translateY(-20px); opacity: 0; } }

Â  Â  /* ì¤€: í¬íƒˆ & ë¯¸ë‹ˆê²Œì„ */
Â  Â  .real-portal { position: absolute; width: 160px; height: 160px; background: radial-gradient(circle, #000, #4b0082, #00ffff); border-radius: 50%; border: 4px solid #fff; box-shadow: 0 0 40px #00ffff, inset 0 0 60px #000; z-index: 45; transform: translate(-50%, -50%) scale(0); }
Â  Â  .portal-opening { animation: pOpen 0.5s forwards; }
Â  Â  .portal-closing { animation: pClose 0.5s forwards; }
Â  Â  @keyframes pOpen { 0% { transform: translate(-50%, -50%) scale(0); } 100% { transform: translate(-50%, -50%) scale(1); } }
Â  Â  @keyframes pClose { 0% { transform: translate(-50%, -50%) scale(1); } 100% { transform: translate(-50%, -50%) scale(0); } }

Â  Â  #timeTunnelBg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2900; pointer-events: none; opacity: 0; transition: opacity 0.5s; display: none; }
Â  Â  .tunnel-star { position: absolute; width: 100px; height: 2px; background: #fff; box-shadow: 0 0 10px #fff; animation: warpSpeed 0.5s linear infinite; }
Â  Â  @keyframes warpSpeed { from { transform: translateX(100vw); } to { transform: translateX(-100vw); } }

Â  Â  #junMiniGameUI { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; flex-direction: column; justify-content: center; align-items: center; color: #fff; text-align: center; }
Â  Â  .warp-btn { width: 120px; height: 120px; border-radius: 50%; background: #00ffff; color: #000; font-weight: 900; font-size: 24px; border: 5px solid #fff; box-shadow: 0 0 20px #00ffff; margin-top: 30px; display: flex; justify-content: center; align-items: center; animation: pulseBtn 0.2s infinite alternate; cursor: pointer; }
Â  Â  @keyframes pulseBtn { from { transform: scale(1); } to { transform: scale(1.05); } }

Â  Â  /* ê°•í¬: íŒë„¬ */
Â  Â  .funnel-unit { position: absolute; width: 40px; height: 40px; background: url('Panel.png') no-repeat center/contain; z-index: 60; pointer-events: none; }
Â  Â  .funnel-laser { position: absolute; height: 6px; background: #ff00ff; box-shadow: 0 0 10px #ff00ff; z-index: 58; transform-origin: left center; opacity: 0; pointer-events: none; }
Â  Â  .gundam-aura { position: absolute; width: 140px; height: 140px; background: radial-gradient(circle, rgba(0,100,255,0.9), rgba(0,255,255,0.4), transparent 70%); border-radius: 50%; box-shadow: 0 0 50px #0000ff, inset 0 0 20px #fff; z-index: 65; pointer-events: none; transform: translate(-50%, -50%); mix-blend-mode: screen; animation: gundamPulse 0.5s infinite alternate; opacity: 0.9; }
Â  Â  @keyframes gundamPulse { from { opacity: 0.7; transform: translate(-50%, -50%) scale(1); } to { opacity: 1; transform: translate(-50%, -50%) scale(1.2); } }

Â  Â  /* ì˜ˆì¤€: ë„í”Œê°±ì–´ & ë‚ ê°œ */
Â  Â  .yejun-clone { position: absolute; width: 50px; height: 50px; background-image: url('skin_yejun.png'); background-size: contain; background-repeat: no-repeat; opacity: 0.8; z-index: 49; filter: hue-rotate(180deg) brightness(1.2); }
Â  Â  .yejun-wing { position: absolute; width: 100px; height: 100px; background: url('Wings.png') no-repeat center/contain; left: -20px; top: -20px; opacity: 0.8; mix-blend-mode: screen; pointer-events: none; }

Â  Â  /* ìŠ¤í…ŒíŒŒë‹ˆ: ì¼€ì´í¬ */
Â  Â  .cake-item { position: absolute; width: 60px; height: 60px; background-size: contain; background-repeat: no-repeat; z-index: 88; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3)); }
Â  Â  .heart-emit { position: absolute; font-size: 30px; color: #ff69b4; font-weight: bold; animation: heartFloat 1s forwards; z-index: 99; }
Â  Â  @keyframes heartFloat { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: translateY(-50px) scale(1.5); opacity: 0; } }
Â  Â  /* ì¼€ì´í¬ ë°°ê²½ */
Â  Â  .cake-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('CakeBack.png') repeat; opacity: 0; pointer-events: none; z-index: 5; transition: opacity 1s; }

Â  Â  /* ì§€í˜œ ìŠ¤í‚¨ ë³€ì‹  */
Â  Â  .jihye-transform-sphere { position: absolute; width: 100px; height: 100px; border-radius: 50%; background: radial-gradient(circle at center, #fff 20%, #ffd700 80%); box-shadow: 0 0 30px #ffd700, 0 0 60px #fff, inset 0 0 20px #fff; z-index: 52; transform: translate(-50%, -50%); animation: sphereCharge 2s ease-in forwards; mix-blend-mode: screen; }
Â  Â  @keyframes sphereCharge { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 20% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; } 80% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; filter: brightness(2); } 100% { transform: translate(-50%, -50%) scale(3); opacity: 0; } }
Â  Â  .jihye-unit { position: absolute; width: 50px; height: 50px; background-size: contain; background-repeat: no-repeat; z-index: 55; filter: drop-shadow(0 0 10px cyan); }
Â  Â  .jihye-missile { position: absolute; width: 24px; height: 24px; background: radial-gradient(circle, #fff, #00b0ff); border-radius: 50%; box-shadow: 0 0 10px #00b0ff; z-index: 66; }

Â  Â  /* ë°°ê²½ ë ˆì´ì–´ */
Â  Â  .bg-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-repeat: repeat-x; }
Â  Â  #bgLayer1 { background-image: url("bg_sky.png"); z-index: 1; background-size: auto 100%; background-position: 0 bottom; }
Â  Â  #bgLayer2 { background-image: url("bg_mountain.png"); z-index: 2; background-size: auto 60%; background-position: 0 bottom; }
Â  Â  #bgLayer3 { background-image: url("bg_forest.png"); z-index: 3; background-size: auto 40%; background-position: 0 bottom; }
Â  Â Â 
Â  Â  .flying-noel { position: absolute; width: 80px; height: 80px; background-image: url('skin_noel.png'); background-size: contain; background-repeat: no-repeat; z-index: 60; pointer-events: none; }
Â  Â Â 
Â  Â  .jieun-shield { position: absolute; width: 90px; height: 90px; left: -15px; bottom: -15px; border-right: 8px solid rgba(255, 255, 255, 0.8); border-radius: 50%; box-shadow: 0 0 20px rgba(255, 255, 255, 0.6); background: linear-gradient(90deg, transparent 50%, rgba(255,255,255,0.2) 100%); pointer-events: none; z-index: 55; }
Â  Â  .haeun-shield { position: absolute; width: 80px; height: 80px; left: -10px; bottom: -10px; border-right: 6px solid rgba(255, 255, 255, 0.9); border-radius: 50%; box-shadow: 15px 0 20px rgba(255, 255, 255, 0.5); pointer-events: none; z-index: 55; animation: shieldBreath 2s infinite ease-in-out; }
Â  Â  @keyframes shieldBreath { 0% { opacity: 0.6; transform: scale(1); } 50% { opacity: 1; transform: scale(1.05); } 100% { opacity: 0.6; transform: scale(1); } }
Â  Â Â 
Â  Â  .heal-effect-visual { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 100px; height: 100px; background: radial-gradient(circle, rgba(255,50,50,0) 20%, rgba(255,0,0,0.6) 60%, transparent 100%); border: 2px solid rgba(255, 100, 100, 0.8); border-radius: 50%; animation: healExpand 0.6s ease-out forwards; z-index: 95; pointer-events: none; }
Â  Â  @keyframes healExpand { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(2.0); opacity: 0; } }

Â  Â  .noel-beam { position: absolute; left: 170px; height: 140px; width: 0; background: radial-gradient(ellipse at left, rgba(255,255,255,1) 0%, rgba(0,255,255,0.8) 30%, rgba(0,100,255,0) 80%); z-index: 89; transform-origin: left center; pointer-events: none; animation: beamFire 0.4s ease-out forwards; mix-blend-mode: screen; box-shadow: 0 0 40px cyan, 0 0 20px white; border-radius: 100px 0 0 100px; }
Â  Â  .noel-beam::before { content: ''; position: absolute; left: -20px; top: 50%; transform: translateY(-50%); width: 80px; height: 80px; background: radial-gradient(circle, #fff 20%, #00ffff 80%, transparent 100%); border-radius: 50%; box-shadow: 0 0 50px #fff; opacity: 0.9; }
Â  Â  @keyframes beamFire { 0% { width: 0; opacity: 0.5; transform: scaleY(0.1); } 20% { width: 50vw; opacity: 1; transform: scaleY(1.2); } 100% { width: 150vw; opacity: 0.8; transform: scaleY(1); } }

Â  Â  #ground { display: none; }
Â  Â  #player { position: absolute; z-index: 50; left: 120px; bottom: 40px; width: 60px; height: 60px; background-image: url("disciple.png"); background-position: center; background-size: contain; background-repeat: no-repeat; image-rendering: pixelated; transition: opacity 0.2s, transform 0.3s; filter: drop-shadow(4px 4px 0 rgba(0,0,0,0.2)); }
Â  Â  #player.fever-active { transform: scale(1.3); filter: drop-shadow(0 0 20px gold); }

Â  Â  .obstacle { position: absolute; z-index: 40; background-size: 8px 8px; box-shadow: 4px 4px 0 rgba(0,0,0,0.2); }
Â  Â  .obs-cap::after { content: ''; position: absolute; left: -10%; width: 120%; height: 24px; border-radius: 4px; }
Â  Â  .obs-ground.obs-cap::after { top: -12px; } .obs-ceil.obs-cap::after { bottom: -12px; }
Â  Â  .obs-log { width: 60px; background-color: #8D6E63; border-left: 4px solid #5D4037; border-right: 4px solid #5D4037; background-image: linear-gradient(90deg, rgba(0,0,0,0.05) 50%, transparent 50%); }
Â  Â  .obs-log.obs-cap::after { background-color: #66BB6A; border: 4px solid #1B5E20; }
Â  Â  .obs-rock { width: 60px; background-color: #9E9E9E; border-left: 4px solid #616161; border-right: 4px solid #616161; background-image: radial-gradient(circle, rgba(0,0,0,0.1) 20%, transparent 20%); }
Â  Â  .obs-rock.obs-cap::after { background-color: #BDBDBD; border: 4px solid #424242; }
Â  Â  .obs-long { width: 240px; height: 35px; background-color: #5D4037; background-image: linear-gradient(0deg, rgba(0,0,0,0.2) 50%, transparent 50%); border: 3px solid #3E2723; border-radius: 8px; box-shadow: 0 5px 5px rgba(0,0,0,0.3); }

Â  Â  .obstacle-explosion { position: absolute; z-index: 85; width: 100px; height: 100px; background: radial-gradient(circle, #fff, orange, transparent); border-radius: 50%; animation: obsExplode 0.4s ease-out forwards; transform: translate(-50%, -50%); }
Â  Â  @keyframes obsExplode { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }

Â  Â  .faith-coin { position: absolute; z-index: 88; width: 24px; height: 24px; background: radial-gradient(circle at 30% 30%, #ffd700, #ff8c00); border: 2px solid #fff; border-radius: 50%; box-shadow: 0 0 10px gold; display: flex; justify-content: center; align-items: center; font-size: 14px; font-weight: bold; color: #fff; }
Â  Â  .faith-coin::after { content: 'âœ'; }

Â  Â  .enemy { position: absolute; z-index: 48; width: 60px; height: 60px; background-position: center; background-size: contain; background-repeat: no-repeat; }
Â  Â  .item { position: absolute; z-index: 45; width: 48px; height: 48px; image-rendering: pixelated; background-position: center; background-repeat: no-repeat; background-size: contain; animation: itemFloat 1.5s ease-in-out infinite alternate; }
Â  Â  @keyframes itemFloat { from { transform: translateY(0); } to { transform: translateY(-8px); } }

Â  Â  .projectile { position: absolute; z-index: 60; width: 30px; height: 30px; border-radius: 50%; transition: opacity 0.2s; }
Â  Â  .enemy-missile { background: radial-gradient(circle, #ff0000, #800000); box-shadow: 0 0 8px #ff0000; }
Â  Â  .boss-missile { width: 40px; height: 40px; background: radial-gradient(circle at 30% 30%, #ffeb3b, #ff5722); animation: spinMeteor 1s linear infinite; }
Â  Â  .player-missile { position: absolute; width: 50px; height: 24px; background: linear-gradient(90deg, #00ffff, #0099ff); border-radius: 12px; box-shadow: 0 0 15px cyan, 0 0 5px white; z-index: 65; border: 2px solid #fff; }
Â  Â Â 
Â  Â  .explosion-area { position: absolute; border-radius: 50%; background: rgba(255, 69, 0, 0.5); border: 2px solid orange; animation: explode 0.5s forwards; z-index: 59; }
Â  Â  @keyframes explode { 0% { transform: scale(0.1); opacity: 1; } 100% { transform: scale(1); opacity: 0; } }

Â  Â  .enemy-laser-warning { position: absolute; height: 2px; background: rgba(255,0,0,0.5); z-index: 49; }
Â  Â  .enemy-laser-beam { position: absolute; height: 30px; background: linear-gradient(to bottom, transparent, red, transparent); box-shadow: 0 0 15px red; z-index: 50; }
Â  Â  .reflected-missile { background: #00ff00 !important; box-shadow: 0 0 15px #00ff00; }
Â  Â  @keyframes spinMeteor { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

Â  Â  .particle { position: absolute; z-index: 90; pointer-events: none; border-radius: 50%; animation: particleFade 0.8s ease-out forwards; }
Â  Â  @keyframes particleFade { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }

Â  Â  #hud { position: fixed; z-index: 900; top: 12px; left: 12px; color: #3a2513; font-size: 18px; font-weight: 700; background: var(--hud-bg); border-radius: 10px; padding: 8px 12px; border: 3px solid var(--hud-border); }
Â  Â  #feverContainer { width: 150px; height: 12px; background: #333; border: 2px solid #3a2513; border-radius: 6px; margin-top: 5px; overflow: hidden; display: flex; }
Â  Â  #feverFill { width: 0%; height: 100%; background: linear-gradient(90deg, #ffd700, #ff8c00); transition: width 0.2s; }
Â  Â Â 
Â  Â  #pauseBtn { position: fixed; z-index: 900; top: 15px; right: 15px; width: 50px; height: 50px; background: #fdfaf2; border: 4px solid #3a2513; border-radius: 12px; box-shadow: 0 4px 0 #8b4f26; display: flex; justify-content: center; align-items: center; font-size: 24px; cursor: pointer; color: #3a2513; transition: transform 0.1s, box-shadow 0.1s; }
Â  Â  #pauseBtn:active { transform: translateY(4px); box-shadow: 0 0 0 #8b4f26; }

Â  Â  /* [ìˆ˜ì • 2] ë²„í”„ ì˜ì—­ ìœ„ì¹˜ ìƒí–¥ ì¡°ì • (ë²„íŠ¼ê³¼ ê²¹ì¹¨ ë°©ì§€) */
Â  Â  #buffArea { position: fixed; z-index: 2147483647; bottom: 120px; right: 15px; display: flex; flex-direction: column-reverse; align-items: flex-end; gap: 8px; pointer-events: none; }
Â  Â  .buff-tag { background: rgba(0, 0, 0, 0.85); color: #fff; padding: 8px 14px; border-radius: 8px; font-weight: 700; border-left: 5px solid; font-size: 14px; box-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
Â  Â  /* íŒ¨ì‹œë¸Œ ì¿¨íƒ€ì„ ì „ìš© ìŠ¤íƒ€ì¼ */
Â  Â  .buff-tag.passive-cd { opacity: 0.7; border-color: #aaa; }

Â  Â  #abilityBtn { position: fixed; bottom: 20px; right: 20px; width: 80px; height: 80px; background: #ff5722; color: white; border-radius: 50%; border: 4px solid #fff; font-weight: bold; font-size: 20px; display: none; justify-content: center; align-items: center; cursor: pointer; z-index: 1000; box-shadow: 0 6px 12px rgba(0,0,0,0.6); }
Â  Â  #abilityBtn.cooldown { filter: grayscale(1); opacity: 0.7; cursor: not-allowed; font-size: 24px; }

Â  Â  #subActionBtn { position: fixed; bottom: 150px; left: 20px; width: 100px; height: 100px; border-radius: 50%; border: 4px solid #fff; color: white; font-weight: 900; font-size: 20px; text-align: center; display: none; justify-content: center; align-items: center; cursor: pointer; z-index: 1000; box-shadow: 0 6px 12px rgba(0,0,0,0.6); transition: transform 0.1s, background-color 0.2s; }
Â  Â  #subActionBtn:active { transform: scale(0.9); }
Â  Â  #subActionBtn.cooldown { filter: grayscale(1); opacity: 0.6; cursor: not-allowed; }
Â  Â  .btn-attack { background-color: #D32F2F !important; }
Â  Â  .btn-defence { background-color: #1976D2 !important; }

Â  Â  #dailyMissionBox { position: fixed; bottom: 20px; left: 20px; background: rgba(0, 0, 0, 0.75); color: #fff; padding: 12px 16px; border-radius: 10px; font-size: 13px; z-index: 800; pointer-events: none; border: 2px solid #3a2513; }
Â  Â  .mission-done { color: #4caf50; text-decoration: line-through; }

Â  Â  #bossContainer { position: absolute; right: -200px; top: 50%; width: 120px; height: 120px; z-index: 55; display: none; transition: right 1s ease-out; }
Â  Â  #bossBody { width: 100%; height: 100%; background: url('boss.png') no-repeat center/contain; image-rendering: pixelated; filter: drop-shadow(0 0 10px red); animation: bossFloat 2s ease-in-out infinite; }
Â  Â  .boss-charging { filter: drop-shadow(0 0 20px yellow) !important; transform: scale(1.1); }
Â  Â  .boss-dashing { filter: drop-shadow(0 0 20px #ff0000) !important; }
Â  Â  @keyframes bossFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
Â  Â  #bossHpBar { position: absolute; top: -20px; left: 0; width: 100%; height: 10px; background: #333; border: 2px solid #000; border-radius: 5px; overflow: hidden; }
Â  Â  #bossHpFill { width: 100%; height: 100%; background: #d32f2f; transition: width 0.2s; }

Â  Â  #bossWarning { position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 50px; font-weight: 900; color: #d32f2f; text-shadow: 3px 3px 0 #000; display: none; z-index: 2000; animation: blink 0.5s infinite; }
Â  Â  @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
Â  Â  .boss-laser { position: absolute; right: 0; height: 40px; background: linear-gradient(to bottom, #ff0000, #fff, #ff0000); z-index: 58; opacity: 0.8; border-top: 2px solid #fff; border-bottom: 2px solid #fff; box-shadow: 0 0 20px #ff0000; pointer-events: none; display: none; }

Â  Â  #speedLines { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 80; background: radial-gradient(circle, transparent 40%, rgba(255, 255, 255, 0.8) 90%); mix-blend-mode: overlay; pointer-events: none; animation: speedShake 0.1s infinite; }
Â  Â  @keyframes speedShake { 0% { transform: translate(0, 0); } 25% { transform: translate(-2px, 2px); } 50% { transform: translate(2px, -2px); } 75% { transform: translate(-2px, -2px); } 100% { transform: translate(0, 0); } }

Â  Â  .float-text { position: absolute; color: #ffe24f; font-weight: 900; font-size: 20px; text-shadow: 2px 2px 0 #3a2513; z-index: 1000; pointer-events: none; animation: floatUp 1s ease-out forwards; }
Â  Â  @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-60px) scale(1.2); opacity: 0; } }

Â  Â  #comboEffect, #correctEffect { position: fixed; left: 50%; transform: translateX(-50%); z-index: 1000; display: none; pointer-events: none; font-weight: 900; text-shadow: 3px 3px #000; }
Â  Â  #comboEffect { top: 20%; font-size: 40px; color: #ffe24f; text-shadow: 3px 3px #8b4f26; }
Â  Â  #correctEffect { top: 40%; font-size: 48px; color: #00ffcc; text-shadow: 3px 3px #006644; }

Â  Â  .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.55); display: none; justify-content: center; align-items: center; padding: 16px; z-index: 20000; }
Â  Â  .modal-box { width: 90%; max-width: 420px; background: var(--panel-bg); border-radius: 14px; border: 4px solid #3a2513; padding: 28px 24px; box-shadow: 0 0 0 4px #fff, 0 10px 0 #b79b76; text-align: center; }
Â  Â  .start-btn, .choice-btn, .action-btn { width: 100%; padding: 14px; margin: 8px 0; background: var(--accent); border: 0; border-radius: 10px; color: #fff; font-size: 18px; font-weight: 700; box-shadow: 0 4px 0 var(--accent-dark); cursor: pointer; }
Â  Â  .choice-btn:active, .action-btn:active, .start-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 var(--accent-dark); }
Â  Â  .action-btn:disabled { background: #999; cursor: not-allowed; box-shadow: none; }
Â  Â  .modal-input { width: 85%; max-width: 320px; padding: 12px; font-size: 16px; border-radius: 8px; border: 2px solid #b8a792; margin: 8px auto 18px; display: block; }
Â  Â  #loadingQuiz { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; color: #fff; font-size: 22px; font-weight: 700; z-index: 20001; }

Â  Â  /* [ìˆ˜ì • 6, 7] Lamb.png -> Lam.png ë° ìœ„ì¹˜/ë°©í–¥ ìˆ˜ì •ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ */
Â  Â  .lamb-unit { position: absolute; width: 60px; height: 60px; background: url('Lam.png') no-repeat center/contain; z-index: 51; filter: drop-shadow(2px 2px 5px rgba(0,0,0,0.3)); }
Â  Â  .lamb-msg { position: absolute; top: -40px; left: 50%; transform: translateX(-50%); background: #fff; border: 3px solid #3a2513; padding: 6px 12px; border-radius: 15px; font-size: 14px; font-weight: 800; white-space: nowrap; box-shadow: 2px 2px 0 rgba(0,0,0,0.2); color: #3a2513; }
Â  Â  .lamb-msg::after { content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); border-width: 10px 8px 0; border-style: solid; border-color: #3a2513 transparent; display: block; width: 0; }

Â  Â  .boba-unit { position: absolute; width: 18px; height: 18px; background: radial-gradient(circle at 30% 30%, #4e342e, #212121); border: 1px solid #000; border-radius: 50%; box-shadow: 2px 2px 3px rgba(0,0,0,0.4); z-index: 65; pointer-events: none; }
Â  Â Â 
Â  Â  .angel-wing-effect { position: absolute; width: 150px; height: 150px; left: 50%; top: 50%; transform: translate(-50%, -50%); display: flex; justify-content: center; align-items: center; font-size: 100px; z-index: 100; text-shadow: 0 0 20px gold, 0 0 40px white; animation: wingRise 2s ease-out forwards; pointer-events: none; }
Â  Â  .angel-wing-effect::after { content: 'ğŸª½'; }
Â  Â  @keyframes wingRise { 0% { opacity: 0; transform: translate(-50%, -20%) scale(0.5); } 20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); } 80% { opacity: 1; transform: translate(-50%, -80%) scale(1.3); } 100% { opacity: 0; transform: translate(-50%, -120%) scale(1.5); } }
Â  </style>
</head>

<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">
<div id="gameArea">
Â  <div id="startGuide" class="modal-bg" style="display:flex;">
Â  Â  <div class="modal-box">
Â  Â  Â  <div style="font-size:28px; font-weight:800; margin-bottom:18px;">ê²Œì„ ë°©ë²•</div>
Â  Â  Â  <div style="text-align:left; font-size:15px; line-height:1.6;">
Â  Â  Â  Â  â€¢ <b>ì í”„:</b> í™”ë©´ í„°ì¹˜ / Space<br>
Â  Â  Â  Â  â€¢ <b>ìŠ¤í‚¬:</b> Aí‚¤ / SKILL ë²„íŠ¼<br>
Â  Â  Â  Â  â€¢ <b>ê³µê²©/ë°©ì–´:</b> Sí‚¤ / Attack ë²„íŠ¼ (200m+)<br><br>
Â  Â  Â  Â  [ì—…ë°ì´íŠ¸]<br>
Â  Â  Â  Â  âš”ï¸ <b>ì „ì°¬:</b> í™”ë ¤í•œ ë²ˆê°œ(íŒ¨ì‹œë¸Œ) & í•´ë¨¸ ì†Œí™˜(ì•¡í‹°ë¸Œ)<br>
Â  Â  Â  Â  ğŸ›¡ï¸ <b>ì§€ì€:</b> ë…¸ì—˜ ì†Œí™˜(íŒ¨ì‹œë¸Œ) & ìŒê³„ íŒŒë„<br>
Â  Â  Â  Â  â³ <b>ì¤€:</b> ë¦¬ì–¼ í…”ë ˆí¬íŠ¸ & ì‹œê³µê°„ ë¯¸ë‹ˆê²Œì„<br>
Â  Â  Â  Â  ğŸŒªï¸ <b>í•˜íœ˜:</b> ì¸í”¼ë‹ˆí‹° ìŠ¤í†¤ & ëª¨ë˜í­í’
Â  Â  Â  </div>
Â  Â  Â  <button class="start-btn" onclick="startGameNow()">â–¶ ì‹œì‘í•˜ê¸° / Start</button>
Â  Â  </div>
Â  </div>

Â  <div id="bgLayer1" class="bg-layer"></div>
Â  <div id="bgLayer2" class="bg-layer"></div>
Â  <div id="bgLayer3" class="bg-layer"></div>
Â  <div id="speedLines"></div>Â 
Â  <div id="jieunWaveBg" class="jieun-wave-bg"></div>
Â  <div id="cakeBg" class="cake-bg"></div>
Â  <div id="sandstormOverlay" class="sandstorm-overlay"></div>
Â Â 
Â  <div id="timeTunnelBg">
Â  Â  Â  <div class="tunnel-star" style="top:10%"></div>
Â  Â  Â  <div class="tunnel-star" style="top:30%; animation-duration:0.3s"></div>
Â  Â  Â  <div class="tunnel-star" style="top:50%; animation-duration:0.7s"></div>
Â  Â  Â  <div class="tunnel-star" style="top:70%; animation-duration:0.4s"></div>
Â  Â  Â  <div class="tunnel-star" style="top:90%"></div>
Â  </div>Â 
Â  <div id="junMiniGameUI">
Â  Â  <div style="font-size:30px; font-weight:900; color:#00ffff; margin-bottom:10px;">ì‹œê³µê°„ ì´ˆì›” ì¤‘!</div>
Â  Â  <div style="font-size:16px; margin-bottom:20px;">í™”ë©´ì„ ì—°íƒ€í•˜ì—¬ ê±°ë¦¬ë¥¼ ëŠ˜ë¦¬ì„¸ìš”!</div>
Â  Â  <div style="font-size:50px; font-weight:bold;"><span id="warpDistance">0</span>m</div>
Â  Â  <div style="font-size:20px; color:#aaa;">(Max 50m)</div>
Â  Â  <div class="warp-btn" ontouchstart="junWarpTap(event)" onclick="junWarpTap(event)">TAP!</div>
Â  Â  <div style="margin-top:20px; font-size:14px;">PC: SpaceBar / Mobile: Tap</div>
Â  </div>

Â  <div id="ground"></div> <div id="player"></div>

Â  <div id="flashEffect"></div>

Â  <div id="bossContainer">
Â  Â  <div id="bossHpBar"><div id="bossHpFill"></div></div>
Â  Â  <div id="bossBody"></div>
Â  </div>
Â  <div id="bossLaser" class="boss-laser"></div>

Â  <div id="hud">
Â  Â  â¤ï¸ <span id="lifeText"></span>Â 
Â  Â  ğŸ“ <span id="distanceText">0m</span>Â 
Â  Â  âœ <span id="faithText"></span>
Â  Â  <div style="display:flex; align-items:center; margin-top:4px;">
Â  Â  Â  Â  <span style="font-size:14px;">ğŸ”¥</span>
Â  Â  Â  Â  <div id="feverContainer"><div id="feverFill"></div></div>
Â  Â  </div>
Â  </div>
Â  Â Â 
Â  <div id="pauseBtn" onclick="togglePause()">â¸ï¸</div>

Â  <div id="abilityBtn" ontouchstart="useAbility(event)" onclick="useAbility(event)">SKILL</div>
Â  <div id="dailyMissionBox"></div>
Â  Â Â 
Â  <div id="subActionBtn" ontouchstart="handleSubAction(event)" onclick="handleSubAction(event)">
Â  </div>
</div>

<div id="buffArea"></div>
<div id="bossWarning">âš ï¸ BOSS WARNING!</div>
<div id="comboEffect">COMBO +1!</div>
<div id="correctEffect">+5 Faith!</div>

<div id="pauseModal" class="modal-bg">
Â  <div class="modal-box">
Â  Â  <div style="font-size:28px; font-weight:800; margin-bottom:15px;">ì¼ì‹œì •ì§€</div>
Â  Â  <button class="action-btn" onclick="resumeGame()">â–¶ ê³„ì†í•˜ê¸°</button>
Â  Â  <button class="action-btn" style="background:#5d4037;" onclick="exitToMenu()">ğŸ  ë©”ë‰´ë¡œ ë‚˜ê°€ê¸°</button>
Â  </div>
</div>

<div id="quizModal" class="modal-bg">
Â  <div class="modal-box">
Â  Â  <div style="font-size:28px; font-weight:800;">ì„±ê²½ í€´ì¦ˆ</div>
Â  Â  <div id="quizQuestion" style="margin:20px 0; font-size:18px;"></div>
Â  Â  <button class="choice-btn" onclick="answerQuiz('A')" id="btnA"></button>
Â  Â  <button class="choice-btn" onclick="answerQuiz('B')" id="btnB"></button>
Â  Â  <button class="choice-btn" onclick="answerQuiz('C')" id="btnC"></button>
Â  </div>
</div>

<div id="gameOverModal" class="modal-bg">
Â  <div class="modal-box">
Â  Â  <div style="font-size:28px; font-weight:800;">GAME OVER</div>
Â  Â  <div style="margin:20px 0;"><b><span id="finalDist"></span>m</b> ë‹¬ë ¸ìŠµë‹ˆë‹¤!</div>
Â  Â  <input id="rankMsg" class="modal-input" type="text" placeholder="ì†Œê° ì…ë ¥(ì„ íƒ)" />
Â  Â  <button class="action-btn" style="background:#5d4037;" onclick="location.reload()">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
Â  Â  <button class="action-btn" onclick="confirmRanking()">[ìˆœìœ„ë“±ë¡]</button>
Â  </div>
</div>

<div id="loadingQuiz">â³ ì„±ê²½ ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

<script>
Â  function isColliding(a, b) {
Â  Â  return (a.x < b.x + b.w && a.x + a.w > b.x &&
Â  Â  Â  Â  Â  Â  a.y < b.y + b.h && a.y + a.h > b.y);
Â  }

Â  const API_URL = "https://script.google.com/macros/s/AKfycbzA10H2TuXRDXBXcttvHHR0Q1sOu8zGpYmrdGhfH-wBsl623k2ydwUkwL7wR8F90mC5Pg/exec";

Â  const sounds = {};
Â  ['bgm', 'jump', 'hit', 'item', 'parry', 'clear'].forEach(name => {
Â  Â  sounds[name] = new Audio(`${name}.mp3`);
Â  Â  if(name==='bgm') {
Â  Â  Â  Â  sounds[name].loop = true;
Â  Â  Â  Â  sounds[name].volume = 0.5;Â 
Â  Â  }
Â  });

Â  function playSound(name) {
Â  Â  if(sounds[name]) {
Â  Â  Â  Â  sounds[name].currentTime = 0;
Â  Â  Â  Â  sounds[name].play().catch(()=>{});
Â  Â  }
Â  }

Â  let id = localStorage.getItem("run_id") || "test_user";
Â  let name = localStorage.getItem("run_name") || "Tester";
Â  let saveData = JSON.parse(localStorage.getItem("run_save") || "{}");

Â  function hasFullCollection() {
Â  Â  const hiddenSkins = ["Hidden_Skin1", "Hidden_Skin2", "Hidden_Skin3", "Hidden_Skin4", "Hidden_Skin5"];
Â  Â  if(!saveData.ownedSkins) return false;
Â  Â  return hiddenSkins.every(skin => saveData.ownedSkins.includes(skin));
Â  }
Â Â 
Â  const collectionBuff = hasFullCollection();

Â  let daily = JSON.parse(localStorage.getItem("dailyMission") || "{}");
Â  function initDailyMission() { return { date: new Date().toDateString(), run200: false, quiz3: 0, faith20: 0, completed: false, version: '3.0' }; }
Â  if (!daily.date || daily.date !== new Date().toDateString() || daily.version !== '3.0') {
Â  Â  daily = initDailyMission(); localStorage.setItem("dailyMission", JSON.stringify(daily));
Â  }

Â  let life = 10 + (saveData.extraLife || 0);
Â  let maxLife = 10 + (saveData.extraLife || 0);

Â  let faith = saveData.faith || 0;
Â  let agility = saveData.agility || 0;
Â  let currentSkin = saveData.equippedSkin || "default";

Â  const SKIN_DATA = {
Â  Â  default: { type: "none" },Â 
Â  Â  noel: { type: "Active", cd: 60 },Â Â 
Â  Â  jeonchan: { type: "Active", cd: 60 },
Â  Â  haeun: { type: "Passive", cd: 30 },Â 
Â  Â  jaeguk: { type: "Active", cd: 70 },Â 
Â  Â  hahwi: { type: "Active", cd: 60 },
Â  Â  jihye: { type: "Active", cd: 60 },Â 
Â  Â  jun: { type: "Active", cd: 90 },
Â  Â  stephanie: { type: "Active", cd: 70 },
Â  Â  yejun: { type: "Active", cd: 50 },
Â  Â  ganghui: { type: "Active", cd: 60 },
Â  Â  jieun: { type: "Active", cd: 60 }
Â  };
Â Â 
Â  const PASSIVE_COOLDOWNS = {
Â  Â  Â  'jeonchan': 15,
Â  Â  Â  'jieun': 40,
Â  Â  Â  'haeun': 25,
Â  Â  Â  'jihye': 25,
Â  Â  Â  'jun': 30,
Â  Â  Â  'noel': 30,
Â  Â  Â  'hahwi': 30,
Â  Â  Â  'yejun': 50,
Â  Â  Â  'stephanie': 30,
Â  Â  Â  'ganghui': 10
Â  };

Â  const abilityBtn = document.getElementById('abilityBtn');
Â  if(SKIN_DATA[currentSkin].type === "Active") abilityBtn.style.display = 'flex';

Â  document.getElementById("lifeText").innerText = life;
Â  document.getElementById("faithText").innerText = faith;

Â  const gameArea = document.getElementById("gameArea");
Â  const player = document.getElementById("player");
Â  const bg1 = document.getElementById("bgLayer1"); const bg2 = document.getElementById("bgLayer2"); const bg3 = document.getElementById("bgLayer3");

Â  if (currentSkin !== 'default') player.style.backgroundImage = `url('skin_${currentSkin}.png')`;
Â  else player.style.backgroundImage = `url('disciple.png')`;

Â  let buffArea = document.getElementById("buffArea");
Â Â 
Â  if(collectionBuff) {
Â  Â  buffArea.innerHTML += `<div class="buff-tag" style="border-color:#e040fb; order:999;">âœ¨ ì»¬ë ‰ì…˜ ë³´ë„ˆìŠ¤ (Faith +10%)</div>`;
Â  }

Â  let speedLines = document.getElementById("speedLines");
Â  let timeTunnelBg = document.getElementById("timeTunnelBg");

Â  let playerObj = { x: 120, y: 40, w: 40, h: 50 };Â 
Â  let velocity = 0;Â 
Â  let gravity = -0.12; let jumpPower = Math.max(3, 4.2 - agility * 0.05);
Â  Â Â 
Â  let targetY = 0;
Â  let distance = 0;
Â  let obstacles = []; let projectiles = [];Â 
Â  let enemies = []; let playerMissiles = [];Â 
Â  let faithCoins = [];
Â  let running = false; let invincible = false;

Â  const BASE_SPEED = 170; let gameSpeed = BASE_SPEED;
Â  let lastTime = performance.now();
Â  let nextQuizDistance = 35;Â 
Â  Â Â 
Â  let obstacleTimer = 0; let nextObstacleTime = 2.0;
Â  let enemySpawnTimer = 0;
Â  let itemTimer = 0; let nextItemTime = 8;
Â  let abilityCD = 0;
Â  let missionUpdateTimer = 0;
Â Â 
Â  let jeonchanTimer = 0;
Â  let haeunLifeTimer = 0;
Â  let haeunShieldTimer = 0;
Â  let haeunShieldActive = false;
Â  let jaegukRevivedOnce = false;Â 
Â  let bobas = [];Â 
Â  let jihyeUnits = [];Â 
Â  let jihyeMissiles = [];Â 
Â  let jihyePassiveTimer = 0;Â 
Â Â 
Â  let jihyeSphereActive = false;
Â  let jihyeSphereEl = null;
Â  let jihyeEndSphereEl = null;

Â  let junLambTimer = 0;
Â  let isJunTimeTravel = false;
Â Â 
Â  let activeLamb = null;

Â  let noelGiantTimer = 0;
Â  let hahwiStoneTimer = 0;
Â  let infinityStones = [];
Â  let sandstormActive = false;
Â  let junMiniGameActive = false;
Â  let junWarpDist = 0;
Â  let ganghuiPanelTimer = 0;
Â  let funnels = [];
Â  let gundamAura = null;
Â  let yejunCloneTimer = 0;
Â  let yejunClones = [];
Â  let stephanieHeartTimer = 0;
Â  let cakeDropTimer = 0;
Â  let cakes = [];
Â  let hammerObj = null;
Â  let musicNotes = [];
Â  let musicWaveActive = false;
Â  let musicNoteTimer = 0;
Â  let jieunNoelTimer = 0;
Â Â 
Â  let coinCombo = 0;
Â  let coinComboTimer = 0;

Â  let bg1X = 0, bg2X = 0, bg3X = 0;
Â  const BG1_SPEED = 20; const BG2_SPEED = 40; const BG3_SPEED = 60;

Â  let items = []; let combo = 0; let obstacleSurviveCount = 0; let rankingSaved = false;
Â  let activeEffects = { turbo: 0, invincible: 0, slow: 0, fly: 0, revive: 0, summon: 0, magnet: 0, noelLaser: 0, bobaTime: 0, hahwiMode: 0, jihyeSquad: 0, junTravel: 0, giant: 0, sandstorm: 0, gundam: 0, cakeWorld: 0, musicWave: 0 };

Â  let feverGauge = 0;
Â  const MAX_FEVER = 100;
Â  let isFeverTime = false;

Â  let isBossBattle = false;
Â  let nextBossTrigger = 200;Â 
Â  let bossLevel = 0;
Â  let boss = { hp: 6, maxHp: 6, x: 0, y: 50, vy: 0.5, state: 'idle', shootTimer: 0, actionTimer: 0 };Â 
Â  let bossContainer = document.getElementById('bossContainer');
Â  let bossBody = document.getElementById('bossBody');
Â  let bossHpFill = document.getElementById('bossHpFill');
Â Â 
Â  let subActionBtn = document.getElementById('subActionBtn');
Â  let shieldCooldown = 0;

Â  function randBetween(min, max) { return Math.random() * (max - min) + min; }

Â  function spawnParticles(x, y, type) {
Â  Â  const colors = type==='item' ? ['#ffd700','#fff'] : type==='spark' ? ['#ff4500','#ff8c00'] : ['#8b4513','#a0522d'];
Â  Â  for(let i=0; i<8; i++) {
Â  Â  Â  Â  const p = document.createElement('div');
Â  Â  Â  Â  p.classList.add('particle');
Â  Â  Â  Â  p.style.background = colors[Math.floor(Math.random()*colors.length)];
Â  Â  Â  Â  p.style.width = (Math.random()*6+4)+'px'; p.style.height = p.style.width;
Â  Â  Â  Â  p.style.left = x + 'px'; p.style.top = y + 'px';
Â  Â  Â  Â  gameArea.appendChild(p);
Â  Â  Â  Â  const tx = (Math.random()-0.5) * 100;
Â  Â  Â  Â  const ty = (Math.random()-0.5) * 100;
Â  Â  Â  Â  p.animate([ { transform: `translate(0,0)` }, { transform: `translate(${tx}px, ${ty}px)` } ], { duration: 600, fill: 'forwards' }).onfinish = () => p.remove();
Â  Â  }
Â  }

Â  function spawnExplosionEffect(x, y) {
Â  Â  Â  const ex = document.createElement('div');
Â  Â  Â  ex.classList.add('obstacle-explosion');
Â  Â  Â  ex.style.left = x + 'px';
Â  Â  Â  ex.style.top = y + 'px';
Â  Â  Â  gameArea.appendChild(ex);
Â  Â  Â  setTimeout(() => ex.remove(), 400);
Â  Â  Â  playSound('hit');
Â  }

Â  function spawnFaithCoins(x, y, count, manualCollection = false, autoCollect = false) {
Â  Â  Â  for(let i=0; i<count; i++) {
Â  Â  Â  Â  Â  const coin = document.createElement('div');
Â  Â  Â  Â  Â  coin.classList.add('faith-coin');
Â  Â  Â  Â  Â  coin.isManual = manualCollection;Â 
Â  Â  Â  Â  Â  coin.isAutoCollect = autoCollect;Â 
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const spreadMult = (!manualCollection && !autoCollect) ? 5 : 1;

Â  Â  Â  Â  Â  const spreadX = (Math.random() - 0.5) * 100 * spreadMult;
Â  Â  Â  Â  Â  const spreadY = (Math.random() - 0.5) * 100 * spreadMult;
Â  Â  Â  Â  Â  coin.style.left = x + 'px'; coin.style.top = y + 'px';
Â  Â  Â  Â  Â  coin.x = x; coin.y = y;
Â  Â  Â  Â  Â  coin.vx = spreadX; coin.vy = spreadY; coin.timer = 0;
Â  Â  Â  Â  Â  gameArea.appendChild(coin); faithCoins.push(coin);
Â  Â  Â  }
Â  }

Â  function createHaeunShield() {
Â  Â  Â  const shield = document.createElement('div');
Â  Â  Â  shield.id = 'haeunShield';
Â  Â  Â  shield.className = 'haeun-shield';
Â  Â  Â  player.appendChild(shield);
Â  }

Â  function removeHaeunShield() {
Â  Â  Â  const shield = document.getElementById('haeunShield');
Â  Â  Â  if(shield) shield.remove();
Â  }

Â  function showHealEffect() {
Â  Â  Â  const heal = document.createElement('div');
Â  Â  Â  heal.className = 'heal-effect-visual';
Â  Â  Â  heal.style.left = '50%';
Â  Â  Â  heal.style.top = '50%';
Â  Â  Â  player.appendChild(heal);Â 
Â  Â  Â  setTimeout(()=>heal.remove(), 600);
Â  }

Â  function triggerJieunMusicWave() {
Â  Â  Â  showFloatText("ğŸµ ë®¤ì§ ì›¨ì´ë¸Œ!");
Â  Â  Â  activeEffects.musicWave = 10;
Â  Â  Â  musicWaveActive = true;
Â  Â  Â  document.getElementById('jieunWaveBg').style.opacity = '1';
Â  }

Â  function activateJieunBuff() {
Â  Â  Â  const noelFly = document.createElement('div');
Â  Â  Â  noelFly.className = 'flying-noel';
Â  Â  Â  noelFly.style.left = (window.innerWidth + 100) + 'px';
Â  Â  Â  noelFly.style.top = '-50px';
Â  Â  Â  gameArea.appendChild(noelFly);

Â  Â  Â  const pRect = { left: playerObj.x, top: window.innerHeight - playerObj.y - playerObj.h };Â 

Â  Â  Â  noelFly.animate([
Â  Â  Â  Â  Â { left: (window.innerWidth + 100) + 'px', top: '-50px', transform: 'rotate(20deg)' },
Â  Â  Â  Â  Â { left: '120px', top: (window.innerHeight - playerObj.y - 60) + 'px', transform: 'rotate(0deg)' }
Â  Â  Â  ], { duration: 800, easing: 'ease-out', fill: 'forwards' }).onfinish = () => {
Â  Â  Â  Â  Â  noelFly.remove();
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const flash = document.getElementById('flashEffect');
Â  Â  Â  Â  Â  flash.style.opacity = '0.8';
Â  Â  Â  Â  Â  setTimeout(() => flash.style.opacity = '0', 100);
Â  Â  Â  Â  Â  playSound('item');Â 

Â  Â  Â  Â  Â  player.style.backgroundImage = `url('Skill_NJ.png')`;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const shield = document.createElement('div');
Â  Â  Â  Â  Â  shield.id = 'jieunShield';
Â  Â  Â  Â  Â  shield.className = 'jieun-shield';
Â  Â  Â  Â  Â  player.appendChild(shield);

Â  Â  Â  Â  Â  activeEffects.summon = 15;
Â  Â  Â  Â  Â  showFloatText("ğŸ›¡ï¸ ë…¸ì—˜ ì†Œí™˜!");
Â  Â  Â  };
Â  }

Â  function deactivateJieunBuff() {
Â  Â  Â  const flash = document.getElementById('flashEffect');
Â  Â  Â  flash.style.opacity = '0.8';
Â  Â  Â  setTimeout(() => flash.style.opacity = '0', 100);

Â  Â  Â  player.style.backgroundImage = `url('skin_jieun.png')`;

Â  Â  Â  const shield = document.getElementById('jieunShield');
Â  Â  Â  if(shield) shield.remove();

Â  Â  Â  const noel = document.createElement('div');
Â  Â  Â  noel.className = 'flying-noel';
Â  Â  Â  noel.style.left = '120px';
Â  Â  Â  noel.style.top = (window.innerHeight - playerObj.y - 60) + 'px';
Â  Â  Â  gameArea.appendChild(noel);

Â  Â  Â  noel.animate([
Â  Â  Â  Â  Â  { left: '120px', top: (window.innerHeight - playerObj.y - 60) + 'px' },
Â  Â  Â  Â  Â  { left: (window.innerWidth + 200) + 'px', top: '-200px' }
Â  Â  Â  ], { duration: 800, easing: 'ease-in', fill: 'forwards' }).onfinish = () => noel.remove();
Â  }

Â  function jump() {
Â  Â  if (!running) {
Â  Â  Â  Â  if (junMiniGameActive) {
Â  Â  Â  Â  Â  Â  junWarpDist++;
Â  Â  Â  Â  Â  Â  if(junWarpDist > 50) junWarpDist = 50;
Â  Â  Â  Â  Â  Â  document.getElementById('warpDistance').innerText = junWarpDist;
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  if (activeEffects.turbo > 0 || activeEffects.fly > 0) return;
Â  Â  velocity = jumpPower;
Â  Â  playSound('jump');
Â  }

Â  function junWarpTap(e) {
Â  Â  Â  if(e) { e.preventDefault(); e.stopPropagation(); }
Â  Â  Â  if (junMiniGameActive) {
Â  Â  Â  Â  Â  junWarpDist++;
Â  Â  Â  Â  Â  if(junWarpDist > 50) junWarpDist = 50;
Â  Â  Â  Â  Â  document.getElementById('warpDistance').innerText = junWarpDist;
Â  Â  Â  }
Â  }

Â  document.addEventListener("touchstart", (e) => {
Â  Â  Â  if(junMiniGameActive) { junWarpTap(e); return; }
Â  Â  Â  if(e.target.closest('.choice-btn') || e.target.closest('#abilityBtn') || e.target.closest('#subActionBtn') || e.target.closest('#pauseBtn') || e.target.closest('.warp-btn')) return;
Â  Â  Â  if (!running) return;
Â  Â  Â  e.preventDefault(); jump();
Â  }, {passive: false});

Â  document.addEventListener("mousedown", (e) => {
Â  Â  Â  Â if(junMiniGameActive) { junWarpTap(e); return; }
Â  Â  Â  Â if(e.target.closest('.choice-btn') || e.target.closest('#abilityBtn') || e.target.closest('#subActionBtn') || e.target.closest('#pauseBtn') || e.target.closest('.warp-btn')) return;
Â  Â  Â  Â if (!running) return;
Â  Â  Â  Â jump();
Â  });
Â Â 
Â  document.addEventListener("keydown", e => {
Â  Â  if (e.code === "Space") {Â 
Â  Â  Â  Â  e.preventDefault();Â 
Â  Â  Â  Â  if(junMiniGameActive) { if(!e.repeat) junWarpTap(null); return; }
Â  Â  Â  Â  if(!e.repeat) jump();Â 
Â  Â  }
Â  Â  if (e.code === "ArrowUp") { e.preventDefault(); jump(); }
Â  Â  if (e.code === "KeyA") useAbility();
Â  Â  if (e.code === "KeyS") handleSubAction();Â 
Â  });
Â  Â Â 
Â  window.addEventListener('mousemove', e => targetY = window.innerHeight - e.clientY);
Â  window.addEventListener('touchmove', e => targetY = window.innerHeight - e.touches[0].clientY);

Â  function togglePause() {
Â  Â  Â  if(!running && !junMiniGameActive) return;Â 
Â  Â  Â  running = false;
Â  Â  Â  document.getElementById('pauseModal').style.display = 'flex';
Â  }

Â  function resumeGame() {
Â  Â  Â  document.getElementById('pauseModal').style.display = 'none';
Â  Â  Â  running = true;
Â  Â  Â  lastTime = performance.now();Â 
Â  Â  Â  requestAnimationFrame(gameLoop);
Â  }

Â  function exitToMenu() {
Â  Â  Â  window.location.href = "/TrapGame/menu.html";
Â  }

Â  function handleSubAction(e) {
Â  Â  Â  if(e) { e.stopPropagation(); e.preventDefault(); }
Â  Â  Â  if (!running) return;
Â  Â  Â  if (isBossBattle) useShield();
Â  Â  Â  else if (distance >= 200) playerShoot();
Â  }

Â  function useShield() {
Â  Â  if (shieldCooldown > 0) return;
Â  Â  shieldCooldown = 0.5;
Â  Â  subActionBtn.classList.add('cooldown');
Â  Â  let reflected = false;
Â  Â  projectiles.forEach(p => {
Â  Â  Â  Â  if (p.isBossMissile && !p.isReflected) {
Â  Â  Â  Â  Â  Â  const dist = Math.hypot(p.x - playerObj.x, p.y - (window.innerHeight - playerObj.y - 30));
Â  Â  Â  Â  Â  Â  if (dist < 150) {
Â  Â  Â  Â  Â  Â  Â  Â  p.isReflected = true;
Â  Â  Â  Â  Â  Â  Â  Â  p.classList.remove('boss-missile');
Â  Â  Â  Â  Â  Â  Â  Â  p.classList.add('reflected-missile');
Â  Â  Â  Â  Â  Â  Â  Â  p.vx = Math.abs(p.vx) * 1.5; p.vy = -p.vy * 0.5;Â 
Â  Â  Â  Â  Â  Â  Â  Â  reflected = true;
Â  Â  Â  Â  Â  Â  Â  Â  spawnParticles(p.x, p.y, 'spark');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  });
Â  Â  if (reflected) { showFloatText("âš”ï¸ ë°˜ì‚¬ ì„±ê³µ!"); playSound('parry'); }
Â  Â  else showFloatText("ğŸ›¡ï¸ ë°©ì–´!");
Â  }

Â  function playerShoot() {
Â  Â  Â  const m = document.createElement("div"); m.classList.add("player-missile");
Â  Â  Â  const startX = playerObj.x + 50;
Â  Â  Â  const startY = (window.innerHeight - playerObj.y - 40);
Â  Â  Â  m.style.left = startX + "px"; m.style.top = startY + "px";Â 
Â  Â  Â  gameArea.appendChild(m); playerMissiles.push(m);
Â  Â  Â  playSound('jump');
Â  }

Â  function triggerJaegukBobas() {
Â  Â  Â  showFloatText("ğŸ§‹ ë²„ë¸”í‹° íŒŒì›Œ!");
Â  Â  Â  activeEffects.bobaTime = 20;Â 
Â  Â  Â  activeEffects.invincible = 20;Â 
Â  Â  Â Â 
Â  Â  Â  for(let i=0; i<5; i++) {
Â  Â  Â  Â  Â  const b = document.createElement('div');
Â  Â  Â  Â  Â  b.className = 'boba-unit';
Â  Â  Â  Â  Â  b.angle = (i / 5) * Math.PI * 2;Â 
Â  Â  Â  Â  Â  b.radius = 60;
Â  Â  Â  Â  Â  b.state = 'orbit';Â 
Â  Â  Â  Â  Â  b.target = null;
Â  Â  Â  Â  Â  gameArea.appendChild(b);
Â  Â  Â  Â  Â  bobas.push(b);
Â  Â  Â  }
Â  Â  Â  playSound('item');
Â  }

Â  function triggerHahwiSkill() {
Â  Â  showFloatText("ğŸŒªï¸ ì‚¬ë§‰ì˜ í­í’!");
Â  Â  activeEffects.sandstorm = 15;
Â  Â  document.getElementById('sandstormOverlay').style.opacity = '1';
Â  Â  gameArea.classList.add('sandstorm-mode');
Â  Â  gameArea.classList.add('sand-bg');
Â  Â  playSound('clear');
Â  }

Â  function triggerJihyeSkill() {
Â  Â  Â  showFloatText("âœ¨ ë°œí‚¤ë¦¬ ë³€ì‹ !");
Â  Â  Â Â 
Â  Â  Â  const sphere = document.createElement('div');
Â  Â  Â  sphere.className = 'jihye-transform-sphere';
Â  Â  Â  gameArea.appendChild(sphere);

Â  Â  Â  jihyeSphereEl = sphere;
Â  Â  Â  jihyeSphereActive = true;

Â  Â  Â  activeEffects.invincible = 2.5;
Â  Â  Â Â 
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  jihyeSphereActive = false;
Â  Â  Â  Â  Â  sphere.remove();
Â  Â  Â  Â  Â  jihyeSphereEl = null;

Â  Â  Â  Â  Â  player.style.backgroundImage = `url('Skill_JH.png')`;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const flash = document.getElementById('flashEffect');
Â  Â  Â  Â  Â  flash.style.opacity = '1';
Â  Â  Â  Â  Â  setTimeout(() => flash.style.opacity = '0', 300);
Â  Â  Â  Â  Â  playSound('clear');

Â  Â  Â  Â  Â  activeEffects.jihyeSquad = 20;Â 

Â  Â  Â  Â  Â  for(let i=1; i<=5; i++) {
Â  Â  Â  Â  Â  Â  Â  const unit = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  unit.className = 'jihye-unit';
Â  Â  Â  Â  Â  Â  Â  unit.style.backgroundImage = `url('Skill_JH${i}.png')`;
Â  Â  Â  Â  Â  Â  Â  unit.x = -100; unit.y = randBetween(50, window.innerHeight/2);
Â  Â  Â  Â  Â  Â  Â  unit.style.left = unit.x + 'px';
Â  Â  Â  Â  Â  Â  Â  unit.style.top = unit.y + 'px';
Â  Â  Â  Â  Â  Â  Â  unit.tx = (window.innerWidth / 2) + randBetween(-100, 100);
Â  Â  Â  Â  Â  Â  Â  unit.ty = (window.innerHeight / 2) + randBetween(-200, 0);
Â  Â  Â  Â  Â  Â  Â  unit.moveTimer = 0;
Â  Â  Â  Â  Â  Â  Â  unit.fireTimer = 0;
Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(unit);
Â  Â  Â  Â  Â  Â  Â  jihyeUnits.push(unit);
Â  Â  Â  Â  Â  }
Â  Â  Â  }, 2000);
Â  }

Â  function endJihyeSkill() {
Â  Â  Â  const sphere = document.createElement('div');
Â  Â  Â  sphere.className = 'jihye-transform-sphere';
Â  Â  Â  sphere.style.left = (playerObj.x + 30) + 'px';
Â  Â  Â  sphere.style.top = (window.innerHeight - playerObj.y - 30) + 'px';
Â  Â  Â  gameArea.appendChild(sphere);
Â  Â  Â Â 
Â  Â  Â  jihyeEndSphereEl = sphere;

Â  Â  Â  activeEffects.invincible = 2.0;

Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  jihyeEndSphereEl = null;
Â  Â  Â  Â  sphere.remove();
Â  Â  Â  Â  player.style.backgroundImage = `url('skin_jihye.png')`;
Â  Â  Â  Â  jihyeUnits.forEach(u => {
Â  Â  Â  Â  Â  Â  u.style.transition = "left 1s ease-in, top 1s ease-in";
Â  Â  Â  Â  Â  Â  u.style.left = '-200px';Â 
Â  Â  Â  Â  Â  Â  setTimeout(() => u.remove(), 1000);
Â  Â  Â  Â  });
Â  Â  Â  Â  jihyeUnits = [];
Â  Â  Â  }, 2000);
Â  }

Â  function triggerJihyeHeal() {
Â  Â  Â  const healer = document.createElement('div');
Â  Â  Â  healer.className = 'jihye-healer';
Â  Â  Â  gameArea.appendChild(healer);
Â  Â  Â Â 
Â  Â  Â  const pillar = document.createElement('div');
Â  Â  Â  pillar.className = 'holy-light-pillar';
Â  Â  Â  gameArea.appendChild(pillar);

Â  Â  Â  healer.style.left = (playerObj.x + 10) + 'px';
Â  Â  Â  healer.style.top = (window.innerHeight - playerObj.y - 80) + 'px';
Â  Â  Â  pillar.style.left = (playerObj.x + 30) + 'px';

Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  life = Math.min(life + 2, maxLife + 5);Â 
Â  Â  Â  Â  Â  document.getElementById("lifeText").innerText = life;
Â  Â  Â  Â  Â  showFloatText("ğŸ’– ì²œì‚¬ì˜ ì¹˜ìœ  (+2)");
Â  Â  Â  Â  Â  playSound('item');
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  healer.style.left = (window.innerWidth + 100) + 'px';
Â  Â  Â  Â  Â  healer.style.top = '-200px';
Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  healer.remove();Â 
Â  Â  Â  Â  Â  Â  Â  pillar.remove();
Â  Â  Â  Â  Â  }, 1500);
Â  Â  Â  }, 2000);
Â  }

Â  // [ìˆ˜ì • 7, 8] í¬íƒˆ ìœ„ì¹˜, ë³µê·€ ì¢Œí‘œ(ë‚™í•˜ ë²„ê·¸ ìˆ˜ì •)
Â  function triggerJunSkill() {
Â  Â  Â  if(isJunTimeTravel) return;
Â  Â  Â  isJunTimeTravel = true;
Â  Â  Â  showFloatText("â³ ì°¨ì›ë¬¸ ê°œë°©!");

Â  Â  Â  const portal = document.createElement('div');
Â  Â  Â  portal.className = 'real-portal portal-opening';
Â  Â  Â Â 
Â  Â  Â  // í”Œë ˆì´ì–´ì˜ ì •ì¤‘ì•™ ì¢Œí‘œ ê³„ì‚°
Â  Â  Â  const playerCenterX = playerObj.x + (playerObj.w / 2);
Â  Â  Â  const playerCenterY = window.innerHeight - playerObj.y - (playerObj.h / 2);

Â  Â  Â  portal.style.left = playerCenterX + 'px';
Â  Â  Â  portal.style.top = playerCenterY + 'px';
Â  Â  Â  gameArea.appendChild(portal);

Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  player.style.transition = "transform 0.5s, left 0.5s, top 0.5s";
Â  Â  Â  Â  Â  player.style.left = playerCenterX + 'px';
Â  Â  Â  Â  Â  // Topìœ¼ë¡œ ê°•ì œ ì´ë™
Â  Â  Â  Â  Â  player.style.top = playerCenterY + 'px';
Â  Â  Â  Â  Â  player.style.bottom = 'auto'; // bottom í•´ì œ
Â  Â  Â  Â  Â  player.style.transform = "translate(-50%, -50%) scale(0)";Â 
Â  Â  Â  }, 500);

Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  timeTunnelBg.style.display = 'block';
Â  Â  Â  Â  Â  timeTunnelBg.style.opacity = '1';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  document.getElementById('junMiniGameUI').style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  junMiniGameActive = true;
Â  Â  Â  Â  Â  Â  Â  running = false;Â 
Â  Â  Â  Â  Â  Â  Â  junWarpDist = 0;
Â  Â  Â  Â  Â  Â  Â  document.getElementById('warpDistance').innerText = "0";

Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  finishJunMiniGame(portal);
Â  Â  Â  Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  Â  }, 500);

Â  Â  Â  }, 1200);
Â  }

Â  function finishJunMiniGame(portal) {
Â  Â  Â  document.getElementById('junMiniGameUI').style.display = 'none';
Â  Â  Â  junMiniGameActive = false;
Â  Â  Â Â 
Â  Â  Â  // í™”ë©´ ì¤‘ì•™ìœ¼ë¡œ í¬íƒˆ ì´ë™
Â  Â  Â  portal.style.left = '50%';Â 
Â  Â  Â  portal.style.top = '50%';
Â  Â  Â Â 
Â  Â  Â  // í”Œë ˆì´ì–´ë„ í™”ë©´ ì¤‘ì•™ìœ¼ë¡œ ì´ë™ (ë³´ì´ì§€ ì•Šì§€ë§Œ ì¢Œí‘œ ë™ê¸°í™”)
Â  Â  Â  player.style.transition = 'none';
Â  Â  Â  player.style.left = '50%';
Â  Â  Â  player.style.top = '50%';
Â  Â  Â Â 
Â  Â  Â  timeTunnelBg.style.opacity = '0';
Â  Â  Â  setTimeout(() => timeTunnelBg.style.display = 'none', 500);

Â  Â  Â  distance += junWarpDist;
Â  Â  Â  document.getElementById("distanceText").innerText = Math.floor(distance) + "m";
Â  Â  Â  showFloatText(`ğŸ“ +${junWarpDist}m ì´ë™!`);

Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  player.style.transition = "transform 0.5s ease-out";
Â  Â  Â  Â  Â  // ì¤‘ì•™ì—ì„œ íŠ€ì–´ë‚˜ì˜¤ê¸°
Â  Â  Â  Â  Â  player.style.transform = 'translate(-50%, -50%) scale(1)';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // [ìˆ˜ì • 8] ë‚™í•˜ ë²„ê·¸ í•´ê²°: ë°”ë‹¥(40)ì´ ì•„ë‹ˆë¼ ê³µì¤‘(í™”ë©´ ì¤‘ê°„) ì¢Œí‘œ í• ë‹¹
Â  Â  Â  Â  Â  playerObj.y = window.innerHeight / 2;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â // ë³µê·€ ì• ë‹ˆë©”ì´ì…˜ (Xì¶•ë§Œ ì´ë™, Yì¶•ì€ ë¬¼ë¦¬ì—”ì§„ì´ ì²˜ë¦¬)
Â  Â  Â  Â  Â  Â  Â  Â player.style.transition = "left 0.5s";
Â  Â  Â  Â  Â  Â  Â  Â player.style.left = "120px";
Â  Â  Â  Â  Â  }, 100);

Â  Â  Â  Â  Â  velocity = 0;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  running = true;Â 
Â  Â  Â  Â  Â  lastTime = performance.now();
Â  Â  Â  Â  Â  requestAnimationFrame(gameLoop);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  player.style.transition = 'none';
Â  Â  Â  Â  Â  Â  Â  player.style.top = ""; // Top ì†ì„± ì œê±° (ë¬¼ë¦¬ì—”ì§„ ë³µê·€)
Â  Â  Â  Â  Â  Â  Â  // ì—¬ê¸°ì„œëŠ” bottomì„ ì„¤ì •í•˜ì§€ ì•Šê³  updatePhysicsê°€ ì²˜ë¦¬í•˜ê²Œ í•¨
Â  Â  Â  Â  Â  Â  Â  player.style.transform = "none";
Â  Â  Â  Â  Â  }, 600);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  portal.classList.remove('portal-opening');
Â  Â  Â  Â  Â  Â  Â  portal.classList.add('portal-closing');
Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { portal.remove(); isJunTimeTravel = false; }, 500);
Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  }, 500);
Â  }

Â  // [ìˆ˜ì • 6, 7] Lamb ë“±ì¥ ìœ„ì¹˜(ì˜¤ë¥¸ìª½) ë° ì´ë¯¸ì§€ëª…(Lam.png) ìˆ˜ì •
Â  function spawnLamb() {
Â  Â  Â  const lamb = document.createElement('div');
Â  Â  Â  lamb.className = 'lamb-unit';
Â  Â  Â  // ì˜¤ë¥¸ìª½ í™”ë©´ ë°–
Â  Â  Â  lamb.x = window.innerWidth + 150;Â 
Â  Â  Â  lamb.y = 50;
Â  Â  Â  lamb.style.left = lamb.x + 'px';
Â  Â  Â  lamb.style.top = lamb.y + 'px';Â 
Â  Â  Â  // ì²˜ìŒì—” ì™¼ìª½ì„ ë°”ë¼ë³´ë„ë¡ (ì´ë¯¸ì§€ ë°©í–¥ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ, ì¼ë‹¨ ìœ ì§€)
Â  Â  Â  lamb.style.transform = "scaleX(-1)";Â 
Â  Â  Â  lamb.style.zIndex = "51";Â 
Â  Â  Â  gameArea.appendChild(lamb);
Â  Â  Â Â 
Â  Â  Â  activeLamb = {
Â  Â  Â  Â  Â  el: lamb,
Â  Â  Â  Â  Â  state: 'approach',
Â  Â  Â  Â  Â  waitTimer: 0,
Â  Â  Â  Â  Â  msgEl: null
Â  Â  Â  };
Â  Â  Â Â 
Â  Â  Â  activeLamb.el.x = lamb.x;
Â  Â  Â  activeLamb.el.y = lamb.y;
Â  }

Â  function updateLamb(dt) {
Â  Â  Â  if(!activeLamb) return;
Â  Â  Â  const lamb = activeLamb;
Â  Â  Â  const pRect = { x: playerObj.x, y: window.innerHeight - playerObj.y - 60 };
Â  Â  Â Â 
Â  Â  Â  if(lamb.state === 'approach') {
Â  Â  Â  Â  Â  const targetX = pRect.x - 50;Â 
Â  Â  Â  Â  Â  const targetY = pRect.y - 50;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // í”Œë ˆì´ì–´ ìª½ìœ¼ë¡œ ì´ë™ (ì™¼ìª½ìœ¼ë¡œ)
Â  Â  Â  Â  Â  lamb.el.x += (targetX - lamb.el.x) * 0.08;
Â  Â  Â  Â  Â  lamb.el.y += (targetY - lamb.el.y) * 0.08;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  lamb.el.style.left = lamb.el.x + 'px';
Â  Â  Â  Â  Â  lamb.el.style.top = lamb.el.y + 'px';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if(Math.abs(lamb.el.x - targetX) < 30 && Math.abs(lamb.el.y - targetY) < 30) {
Â  Â  Â  Â  Â  Â  Â  lamb.state = 'talk';
Â  Â  Â  Â  Â  Â  Â  const messages = ["í™”ì´íŒ…!", "í˜ë‚´ì„¸ìš”!", "ì£¼ë‹˜ì´ í•¨ê»˜í•´ìš”!", "ê¸°ì¨ì´ ê°€ë“í•˜ê¸¸!", "í‰ì•ˆí•˜ì„¸ìš”!"];
Â  Â  Â  Â  Â  Â  Â  const randomMsg = messages[Math.floor(Math.random() * messages.length)];
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  const msg = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  msg.className = 'lamb-msg';
Â  Â  Â  Â  Â  Â  Â  msg.innerText = randomMsg;
Â  Â  Â  Â  Â  Â  Â  msg.style.transform = "scaleX(-1)";
Â  Â  Â  Â  Â  Â  Â  msg.style.display = "inline-block";
Â  Â  Â  Â  Â  Â  Â  lamb.el.appendChild(msg);
Â  Â  Â  Â  Â  Â  Â  lamb.msgEl = msg;
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  if(life < maxLife + 5) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  life++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("lifeText").innerText = life;
Â  Â  Â  Â  Â  Â  Â  Â  Â  showHealEffect();
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  } else if(lamb.state === 'talk') {
Â  Â  Â  Â  Â  lamb.waitTimer += dt;
Â  Â  Â  Â  Â  if(lamb.waitTimer > 1.5) {Â 
Â  Â  Â  Â  Â  Â  Â  lamb.state = 'leave';
Â  Â  Â  Â  Â  Â  Â  // í‡´ì¥ ì‹œ ë°©í–¥ ì „í™˜ (ì˜¤ë¥¸ìª½ ë³´ê¸°)
Â  Â  Â  Â  Â  Â  Â  lamb.el.style.transform = "scaleX(1)";
Â  Â  Â  Â  Â  Â  Â  if(lamb.msgEl) lamb.msgEl.remove();
Â  Â  Â  Â  Â  }
Â  Â  Â  } else if(lamb.state === 'leave') {
Â  Â  Â  Â  Â  // ì˜¤ë¥¸ìª½ìœ¼ë¡œ í‡´ì¥
Â  Â  Â  Â  Â  lamb.el.x += 400 * dt;Â 
Â  Â  Â  Â  Â  lamb.el.style.left = lamb.el.x + 'px';
Â  Â  Â  Â  Â  if(lamb.el.x > window.innerWidth + 150) {
Â  Â  Â  Â  Â  Â  Â  lamb.el.remove();
Â  Â  Â  Â  Â  Â  Â  activeLamb = null;
Â  Â  Â  Â  Â  }
Â  Â  Â  }
Â  }
Â Â 
Â  // [ìˆ˜ì • 1] ì „ì°¬ í•´ë¨¸: ì†ë„ ë° ì§€ì†ì‹œê°„ ìˆ˜ì • (20ì´ˆ ë™ì•ˆ í™”ë©´ íš¡ë‹¨)
Â  function triggerJeonchanHammer() {
Â  Â  Â  showFloatText("ğŸ”¨ ì‹¬íŒì˜ ë§ì¹˜!");
Â  Â  Â  gameArea.classList.add('shake-screen');
Â  Â  Â  setTimeout(() => gameArea.classList.remove('shake-screen'), 500);Â 

Â  Â  Â  hammerObj = document.createElement('div');
Â  Â  Â  hammerObj.className = 'hammer-skill';
Â  Â  Â  hammerObj.x = -400; // í™”ë©´ ì™¼ìª½ ë°– ì‹œì‘
Â  Â  Â  hammerObj.y = 50;Â  Â // ìƒë‹¨
Â  Â  Â Â 
Â  Â  Â  // í™”ë©´ ì „ì²´ ë„ˆë¹„ + í•´ë¨¸ ë„ˆë¹„ + ì—¬ìœ ë¶„ì„ 20ì´ˆ ë™ì•ˆ ì´ë™
Â  Â  Â  const totalDist = window.innerWidth + 800;Â 
Â  Â  Â  hammerObj.vx = totalDist / 20; // 20ì´ˆ ì§€ì† ì†ë„ ê³„ì‚°

Â  Â  Â  hammerObj.style.left = hammerObj.x + 'px';
Â  Â  Â  hammerObj.style.top = hammerObj.y + 'px';
Â  Â  Â  gameArea.appendChild(hammerObj);
Â  }

Â  function triggerJeonchanLightning() {
Â  Â  Â  let strikes = 0;
Â  Â  Â  const storm = setInterval(() => {
Â  Â  Â  Â  Â  if(strikes > 10) { clearInterval(storm); return; }
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const strike = document.createElement('div');
Â  Â  Â  Â  Â  strike.className = 'jc-lightning-strike';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const randX = randBetween(50, window.innerWidth - 50);Â 
Â  Â  Â  Â  Â  strike.style.left = randX + 'px';
Â  Â  Â  Â  Â  strike.style.top = '-120vh';Â 
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  strike.style.transform = `rotate(${randBetween(-15, 15)}deg)`;Â 
Â  Â  Â  Â  Â  strike.style.width = randBetween(10, 30) + "px";
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  gameArea.appendChild(strike);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  strike.animate([
Â  Â  Â  Â  Â  Â  Â  { top: '-120vh', opacity: 0 },
Â  Â  Â  Â  Â  Â  Â  { top: '-20vh', opacity: 1 },Â 
Â  Â  Â  Â  Â  Â  Â  { top: '-20vh', opacity: 0 }
Â  Â  Â  Â  Â  ], { duration: 150, fill: 'forwards' }).onfinish = () => strike.remove();

Â  Â  Â  Â  Â  obstacles.forEach(o => {
Â  Â  Â  Â  Â  Â  Â  if(o.x > randX - 80 && o.x < randX + 80 && !o.destroyed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x, window.innerHeight - parseFloat(o.style.bottom || 0) - 50);
Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(o.x, window.innerHeight - 150, 3, false, true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  o.remove();
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  enemies.forEach(e => {
Â  Â  Â  Â  Â  Â  Â  if(!e.isDead && e.x > randX - 80 && e.x < randX + 80) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  e.isDead = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(e.x, e.y);
Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(e.x, e.y, 5, false, true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  e.remove();
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if(strikes % 3 === 0) playSound('clear');
Â  Â  Â  Â  Â  strikes++;
Â  Â  Â  }, 80);
Â  }

Â  function triggerStephanieSkill() {
Â  Â  Â  showFloatText("ğŸ° ì¼€ì´í¬ ì›”ë“œ!");
Â  Â  Â  activeEffects.cakeWorld = 20;
Â  Â  Â  document.getElementById('cakeBg').style.opacity = '1';
Â  Â  Â  cakeDropTimer = 0;
Â  }
Â Â 
Â  function triggerYejunClones() {
Â  Â  Â  showFloatText("ğŸ’¨ ë„í”Œê°±ì–´ ì†Œí™˜!");
Â  Â  Â  activeEffects.invincible = 15;

Â  Â  Â  for(let i=0; i<5; i++) {
Â  Â  Â  Â  Â  const clone = document.createElement('div');
Â  Â  Â  Â  Â  clone.className = 'yejun-clone';
Â  Â  Â  Â  Â  clone.x = playerObj.x + randBetween(-50, 50);
Â  Â  Â  Â  Â  clone.y = playerObj.y + randBetween(20, 100);
Â  Â  Â  Â  Â  clone.style.left = clone.x + 'px';
Â  Â  Â  Â  Â  clone.style.bottom = clone.y + 'px';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  clone.vx = randBetween(-3, 3);
Â  Â  Â  Â  Â  clone.vy = randBetween(-3, 3);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  gameArea.appendChild(clone);
Â  Â  Â  Â  Â  yejunClones.push({ el: clone, fireTimer: Math.random(), vx: clone.vx, vy: clone.vy });
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  yejunClones.forEach(c => {
Â  Â  Â  Â  Â  Â  Â  spawnParticles(c.el.x, c.el.y, 'dust');
Â  Â  Â  Â  Â  Â  Â  c.el.remove();
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  yejunClones = [];
Â  Â  Â  }, 15000);Â 
Â  }

Â  function triggerGanghuiGundam() {
Â  Â  Â  showFloatText("ğŸ¤– ê±´ë‹´ ëª¨ë“œ ê°€ë™!");
Â  Â  Â  player.style.backgroundImage = `url('Gundam.png')`;
Â  Â  Â Â 
Â  Â  Â  const flash = document.getElementById('flashEffect');
Â  Â  Â  flash.style.background = "rgba(0, 100, 255, 0.5)";
Â  Â  Â  flash.style.opacity = '1';
Â  Â  Â  setTimeout(() => flash.style.opacity = '0', 300);

Â  Â  Â  gundamAura = document.createElement('div');
Â  Â  Â  gundamAura.className = 'gundam-aura';
Â  Â  Â  gameArea.appendChild(gundamAura);
Â  Â  Â Â 
Â  Â  Â  activeEffects.gundam = 15;
Â  Â  Â Â 
Â  Â  Â  for(let i=0; i<6; i++) {
Â  Â  Â  Â  Â  spawnFunnel();
Â  Â  Â  }
Â  }
Â Â 
Â  function spawnFunnel() {
Â  Â  Â  if(funnels.length >= 8) return;
Â  Â  Â  const f = document.createElement('div');
Â  Â  Â  f.className = 'funnel-unit';
Â  Â  Â  f.x = -50; f.y = randBetween(50, window.innerHeight-100);
Â  Â  Â  f.style.left = f.x + 'px';
Â  Â  Â  f.style.top = f.y + 'px';
Â  Â  Â  f.tx = randBetween(100, window.innerWidth-100);
Â  Â  Â  f.ty = randBetween(50, window.innerHeight-100);
Â  Â  Â  f.timer = 0;
Â  Â  Â  f.fireCD = Math.random() * 4;
Â  Â  Â  gameArea.appendChild(f);
Â  Â  Â  funnels.push(f);
Â  }

Â  function useAbility(e) {
Â  Â  if(e) e.stopPropagation();
Â  Â  if(!running || abilityCD > 0) return;
Â  Â  const s = SKIN_DATA[currentSkin];
Â  Â Â 
Â  Â  if(currentSkin === 'noel') {
Â  Â  Â  showFloatText("ğŸŒŠ ì—ë„ˆì§€ íŒŒ!");
Â  Â  Â  activeEffects.noelLaser = 10;Â 
Â  Â  Â  const beam = document.createElement('div');
Â  Â  Â  beam.id = 'noelBeam'; beam.className = 'noel-beam';
Â  Â  Â  gameArea.appendChild(beam);
Â  Â  Â  gameArea.classList.add('shake-screen');
Â  Â  Â  playSound('clear');Â 
Â  Â  }Â 
Â  Â  else if(currentSkin === 'jaeguk') { triggerJaegukBobas(); }
Â  Â  else if(currentSkin === 'hahwi') { triggerHahwiSkill(); }
Â  Â  else if(currentSkin === 'jihye') { triggerJihyeSkill(); }
Â  Â  else if(currentSkin === 'jun') { triggerJunSkill(); }
Â  Â  else if(currentSkin === 'yejun') {Â 
Â  Â  Â  Â  activeEffects.fly = 20;Â 
Â  Â  Â  Â  targetY = playerObj.y;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  const wings = document.createElement('div');
Â  Â  Â  Â  wings.className = 'yejun-wing';
Â  Â  Â  Â  player.appendChild(wings);
Â  Â  Â  Â  showFloatText("âœˆï¸ ë¬´ì¤‘ë ¥ ì œì–´");Â 
Â  Â  }Â 
Â  Â  else if(currentSkin === 'jieun') { triggerJieunMusicWave(); }
Â  Â  else if(currentSkin === 'jeonchan') { triggerJeonchanHammer(); }
Â  Â  else if(currentSkin === 'ganghui') { triggerGanghuiGundam(); }
Â  Â  else if(currentSkin === 'stephanie') { triggerStephanieSkill(); }

Â  Â  abilityCD = s.cd;
Â  }

Â  function updateBuffUI(delta) {
Â  Â  const buffContainer = document.getElementById("buffArea");Â 
Â  Â  let html = "";
Â  Â  if(collectionBuff) html += `<div class="buff-tag" style="border-color:#e040fb; order:999;">âœ¨ ì»¬ë ‰ì…˜ ë³´ë„ˆìŠ¤ (Faith +10%)</div>`;

Â  Â  if (!isFeverTime) {
Â  Â  Â  Â  document.getElementById("feverFill").style.width = feverGauge + "%";
Â  Â  Â  Â  if(feverGauge >= MAX_FEVER) startFeverTime();
Â  Â  } else {
Â  Â  Â  Â  feverGauge -= (delta * 20);
Â  Â  Â  Â  document.getElementById("feverFill").style.width = feverGauge + "%";
Â  Â  Â  Â  if(feverGauge <= 0) endFeverTime();
Â  Â  }

Â  Â  for(let k in activeEffects) {
Â  Â  Â  Â  if(activeEffects[k] > 0) {
Â  Â  Â  Â  Â  Â  activeEffects[k] -= delta;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(k === 'summon' && currentSkin === 'jieun') {
Â  Â  Â  Â  Â  Â  Â  Â  if(activeEffects[k] <= 0) deactivateJieunBuff();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(k === 'noelLaser') {
Â  Â  Â  Â  Â  Â  Â  Â  if(activeEffects[k] <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const beam = document.getElementById('noelBeam');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(beam) beam.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameArea.classList.remove('shake-screen');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(k === 'sandstorm' && activeEffects[k] <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('sandstormOverlay').style.opacity = '0';
Â  Â  Â  Â  Â  Â  Â  Â  gameArea.classList.remove('sandstorm-mode');
Â  Â  Â  Â  Â  Â  Â  Â  gameArea.classList.remove('sand-bg');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(k === 'jihyeSquad' && activeEffects[k] <= 0) endJihyeSkill();
Â  Â  Â  Â  Â  Â  if(k === 'bobaTime' && activeEffects[k] <= 0) { bobas.forEach(b => b.remove()); bobas = []; activeEffects.invincible = 0; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(k === 'gundam' && activeEffects[k] <= 0) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  player.style.backgroundImage = `url('skin_ganghui.png')`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(gundamAura) { gundamAura.remove(); gundamAura = null; }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const endAura = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  endAura.className = 'gundam-aura';
Â  Â  Â  Â  Â  Â  Â  Â  endAura.style.animation = "obsExplode 0.5s ease-out forwards";Â 
Â  Â  Â  Â  Â  Â  Â  Â  endAura.style.left = (playerObj.x + 30) + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  endAura.style.top = (window.innerHeight - playerObj.y - 30) + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(endAura);
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => endAura.remove(), 500);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if(k === 'fly' && currentSkin === 'yejun' && activeEffects[k] <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const w = player.querySelector('.yejun-wing');
Â  Â  Â  Â  Â  Â  Â  Â  if(w) w.remove();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(k === 'cakeWorld' && activeEffects[k] <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('cakeBg').style.opacity = '0';
Â  Â  Â  Â  Â  Â  Â  Â  cakes.forEach(c => c.remove()); cakes = [];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(k === 'musicWave' && activeEffects[k] <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  musicWaveActive = false;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('jieunWaveBg').style.opacity = '0';
Â  Â  Â  Â  Â  Â  Â  Â  musicNotes.forEach(n => n.remove()); musicNotes = [];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(k === 'giant' && activeEffects[k] <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  player.style.transform = "scale(1)";
Â  Â  Â  Â  Â  Â  Â  Â  const aura = player.querySelector('.noel-aura');
Â  Â  Â  Â  Â  Â  Â  Â  if(aura) aura.remove();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if(activeEffects[k] > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  let color = "#fff"; let icon = ""; let label = k;
Â  Â  Â  Â  Â  Â  Â  Â  if(k === 'invincible') { color = "#ffd700"; icon = "ğŸ›¡ï¸"; label = "ë¬´ì "; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'turbo') { color = "#00e5ff"; icon = "ğŸš€"; label = "í„°ë³´"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'slow') { color = "#90ee90"; icon = "ğŸƒ"; label = "ê°ì†"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'fly') { color = "#87ceeb"; icon = "âœˆï¸"; label = "ë¹„í–‰"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'revive') { color = "#ff69b4"; icon = "ğŸ‘¼"; label = "ë¶€í™œ"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'noelLaser') { color = "#00ffff"; icon = "ğŸŒŠ"; label = "ì—ë„ˆì§€íŒŒ"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'summon') { color = "#e040fb"; icon = "âœ¨"; label = "ë…¸ì—˜ ì†Œí™˜"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'bobaTime') { color = "#795548"; icon = "ğŸ§‹"; label = "ë³´ë°” íƒ€ì„"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'sandstorm') { color = "#d2b48c"; icon = "ğŸŒªï¸"; label = "ëª¨ë˜í­í’"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'jihyeSquad') { color = "#ff9100"; icon = "âš”ï¸"; label = "ë°œí‚¤ë¦¬"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'gundam') { color = "#0000ff"; icon = "ğŸ¤–"; label = "ê±´ë‹´"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'cakeWorld') { color = "#ff69b4"; icon = "ğŸ°"; label = "ì¼€ì´í¬"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(k === 'musicWave') { color = "#ff00ff"; icon = "ğŸµ"; label = "ìŒê³„íŒŒë„"; }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(k !== 'magnet') html += `<div class="buff-tag" style="border-color:${color}">${icon} ${label} ${Math.ceil(activeEffects[k])}s</div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else { activeEffects[k] = 0; }
Â  Â  }
Â  Â Â 
Â  Â  // [ìˆ˜ì • 2, 3, 11] íŒ¨ì‹œë¸Œ ì¿¨íƒ€ì„ í‘œì‹œ: ì¡°ê±´ë¬¸ ìˆ˜ì • ë° í•˜ì€ 2ê°œ íŒ¨ì‹œë¸Œ ì²˜ë¦¬
Â  Â  const passiveSkins = ['jeonchan', 'noel', 'haeun', 'hahwi', 'jihye', 'jun', 'stephanie', 'ganghui', 'jieun', 'yejun'];
Â  Â  if(SKIN_DATA[currentSkin].type === "Passive" || passiveSkins.includes(currentSkin)) {
Â  Â  Â  Â  let limit = PASSIVE_COOLDOWNS[currentSkin] || 30;
Â  Â  Â  Â  let label = "íŒ¨ì‹œë¸Œ";
Â  Â  Â  Â  let timerVal = 0;

Â  Â  Â  Â  if (currentSkin === 'haeun') {
Â  Â  Â  Â  Â  Â  // í•˜ì€ ìŠ¤í˜ì…œ ë¡œì§: 2ê°œì˜ íŒ¨ì‹œë¸Œ
Â  Â  Â  Â  Â  Â  let shieldRemain = Math.ceil(haeunShieldTimer - 10); // ì¿¨íƒ€ì„ 10ì´ˆë¡œ ê°€ì • (ê²Œì„ë£¨í”„ ë¡œì§ í™•ì¸ í•„ìš”)
Â  Â  Â  Â  Â  Â  // ê²Œì„ë£¨í”„ ë¡œì§: if(haeunShieldTimer >= 10.0)
Â  Â  Â  Â  Â  Â  if(haeunShieldTimer > 0 && haeunShieldTimer < 10) {
Â  Â  Â  Â  Â  Â  Â  Â  Â html += `<div class="buff-tag passive-cd">ğŸ›¡ï¸ ë³´í˜¸ë§‰ ${Math.ceil(10 - haeunShieldTimer)}s</div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(haeunLifeTimer > 0 && haeunLifeTimer < 25) {
Â  Â  Â  Â  Â  Â  Â  Â  Â html += `<div class="buff-tag passive-cd">ğŸ’– í ${Math.ceil(25 - haeunLifeTimer)}s</div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // ë‚˜ë¨¸ì§€ ìŠ¤í‚¨ ë‹¨ì¼ íŒ¨ì‹œë¸Œ
Â  Â  Â  Â  Â  Â  if(currentSkin === 'jeonchan') { timerVal = jeonchanTimer; label = "âš¡ ë²ˆê°œ"; }
Â  Â  Â  Â  Â  Â  else if(currentSkin === 'jieun') { timerVal = jieunNoelTimer; label = "ğŸ›¡ï¸ ì†Œí™˜"; }
Â  Â  Â  Â  Â  Â  else if(currentSkin === 'jihye') { timerVal = jihyePassiveTimer; label = "ğŸ’– í"; }
Â  Â  Â  Â  Â  Â  else if(currentSkin === 'jun') { timerVal = junLambTimer; label = "ğŸ‘ ì–´ë¦°ì–‘"; }
Â  Â  Â  Â  Â  Â  else if(currentSkin === 'noel') { timerVal = noelGiantTimer; label = "ğŸ¦¶ ê±°ëŒ€í™”"; }
Â  Â  Â  Â  Â  Â  else if(currentSkin === 'hahwi') { timerVal = hahwiStoneTimer; label = "ğŸ’ ìŠ¤í†¤"; }
Â  Â  Â  Â  Â  Â  else if(currentSkin === 'yejun') { timerVal = yejunCloneTimer; label = "ğŸ’¨ ë¶„ì‹ "; }
Â  Â  Â  Â  Â  Â  else if(currentSkin === 'stephanie') { timerVal = stephanieHeartTimer; label = "â¤ï¸ í•˜íŠ¸"; }
Â  Â  Â  Â  Â  Â  else if(currentSkin === 'ganghui') { timerVal = ganghuiPanelTimer; label = "ğŸ›°ï¸ íŒë„¬"; }

Â  Â  Â  Â  Â  Â  if(timerVal > 0 && timerVal < limit) {
Â  Â  Â  Â  Â  Â  Â  Â  Â let remain = Math.ceil(limit - timerVal);
Â  Â  Â  Â  Â  Â  Â  Â  Â html += `<div class="buff-tag passive-cd">${label} ${remain}s</div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  buffContainer.innerHTML = html;

Â  Â  if(shieldCooldown > 0) { shieldCooldown -= delta; if(shieldCooldown <= 0) subActionBtn.classList.remove('cooldown'); }
Â  Â  updateAbilityBtn(delta); updateSubActionButtonUI();
Â  }

Â  function startFeverTime() {
Â  Â  Â  isFeverTime = true; feverGauge = 100;
Â  Â  Â  activeEffects.invincible = 5; activeEffects.turbo = 5; activeEffects.magnet = 5;
Â  Â  Â  gameArea.classList.add("fever-mode"); player.classList.add("fever-active");
Â  Â  Â  showFloatText("ğŸ”¥ ì„±ë ¹ ì¶©ë§Œ! (FEVER)"); playSound('clear');
Â  }

Â  function endFeverTime() {
Â  Â  Â  isFeverTime = false; feverGauge = 0;
Â  Â  Â  activeEffects.invincible = 0; activeEffects.turbo = 0; activeEffects.magnet = 0;
Â  Â  Â  gameArea.classList.remove("fever-mode"); player.classList.remove("fever-active");
Â  }

Â  function updateSubActionButtonUI() {
Â  Â  Â  if (isBossBattle) {
Â  Â  Â  Â  Â  subActionBtn.style.display = 'flex'; subActionBtn.className = 'btn-defence'; subActionBtn.innerText = "Defence";Â 
Â  Â  Â  } else if (distance >= 200) {
Â  Â  Â  Â  Â  subActionBtn.style.display = 'flex'; subActionBtn.className = 'btn-attack'; subActionBtn.innerText = "Attack";
Â  Â  Â  } else { subActionBtn.style.display = 'none'; }
Â  }

Â  function updateAbilityBtn(dt) {
Â  Â  if(abilityCD > 0) { abilityCD -= dt; abilityBtn.classList.add('cooldown'); abilityBtn.innerHTML = Math.ceil(abilityCD); }Â 
Â  Â  else { abilityBtn.classList.remove('cooldown'); abilityBtn.innerHTML = "SKILL"; }
Â  }

Â  let lastMissionHTML = "";
Â  function updateDailyMissionUI() {
Â  Â  const box = document.getElementById('dailyMissionBox');
Â  Â  if (daily.completed || isBossBattle) { box.style.display = 'none'; return; }
Â  Â  box.style.display = 'block';
Â  Â  const m1 = daily.run200 ? 'mission-done' : ''; const m2 = daily.quiz3 >= 3 ? 'mission-done' : ''; const m3 = daily.faith20 >= 20 ? 'mission-done' : '';
Â  Â  const newHTML = `
Â  Â  Â  <div style="margin-bottom:5px; font-weight:bold; border-bottom:1px solid #555; padding-bottom:3px;">ğŸ“… ì¼ì¼ ë¯¸ì…˜</div>
Â  Â  Â  <div class="mission-item ${m1}">ğŸƒ 200m ë‹¬ë¦¬ê¸°</div>
Â  Â  Â  <div class="mission-item ${m2}">ğŸ§  í€´ì¦ˆ 3íšŒ (${daily.quiz3}/3)</div>
Â  Â  Â  <div class="mission-item ${m3}">âœ Faith 20 (${Math.min(daily.faith20, 20)}/20)</div>
Â  Â  `;
Â  Â  if(newHTML !== lastMissionHTML) { box.innerHTML = newHTML; lastMissionHTML = newHTML; }
Â  }

Â  function checkMissions() {
Â  Â  if (daily.completed) return;
Â  Â  if(distance < 5) return;Â 
Â  Â  let changed = false;
Â  Â  if (!daily.run200 && distance >= 200) { daily.run200 = true; changed = true; }
Â  Â  if (daily.run200 && daily.quiz3 >= 3 && daily.faith20 >= 20) {
Â  Â  Â  Â  daily.completed = true; faith += 200;
Â  Â  Â  Â  saveData.faith = faith; document.getElementById("faithText").innerText = faith;
Â  Â  Â  Â  showFloatText("ğŸ‰ ì¼ì¼ ë¯¸ì…˜ ì™„ë£Œ! (+200 Faith)"); playSound('clear');
Â  Â  Â  Â  saveProgress(); changed = true; updateDailyMissionUI();
Â  Â  }
Â  Â  if(changed) { localStorage.setItem("dailyMission", JSON.stringify(daily)); updateDailyMissionUI(); }
Â  }

Â  function gameLoop(now) {
Â  Â  if (!running) return;
Â  Â  const delta = (now - lastTime) / 1000; lastTime = now;
Â  Â  const safeDelta = Math.min(delta, 0.05);

Â  Â  try {
Â  Â  Â  Â  updateBuffUI(safeDelta);
Â  Â  Â  Â  checkMissions();
Â  Â  Â  Â Â 
Â  Â  Â  Â  missionUpdateTimer += safeDelta;
Â  Â  Â  Â  if(missionUpdateTimer > 1.0) { updateDailyMissionUI(); missionUpdateTimer = 0; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(coinCombo > 0) {
Â  Â  Â  Â  Â  Â  coinComboTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(coinComboTimer > 0.5) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  coinCombo = 0;
Â  Â  Â  Â  Â  Â  Â  Â  coinComboTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(jihyeSphereActive && jihyeSphereEl) {
Â  Â  Â  Â  Â  Â  jihyeSphereEl.style.left = (playerObj.x + 30) + 'px';
Â  Â  Â  Â  Â  Â  jihyeSphereEl.style.top = (window.innerHeight - playerObj.y - 30) + 'px';
Â  Â  Â  Â  }
Â  Â  Â  Â  if(jihyeEndSphereEl) {
Â  Â  Â  Â  Â  Â  jihyeEndSphereEl.style.left = (playerObj.x + 30) + 'px';
Â  Â  Â  Â  Â  Â  jihyeEndSphereEl.style.top = (window.innerHeight - playerObj.y - 30) + 'px';
Â  Â  Â  Â  }

Â  Â  Â  Â  if(gundamAura) {
Â  Â  Â  Â  Â  Â  Â gundamAura.style.left = (playerObj.x + 30) + 'px';
Â  Â  Â  Â  Â  Â  Â gundamAura.style.top = (window.innerHeight - playerObj.y - 30) + 'px';
Â  Â  Â  Â  }

Â  Â  Â  Â  updateLamb(safeDelta);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(hammerObj) {
Â  Â  Â  Â  Â  Â  hammerObj.x += hammerObj.vx * safeDelta;
Â  Â  Â  Â  Â  Â  hammerObj.style.left = hammerObj.x + 'px';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // í•´ë¨¸ ëë¶€ë¶„ì—ì„œ ë²ˆê°œ íŠ€ê¹€
Â  Â  Â  Â  Â  Â  if(Math.random() < 0.3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â const spark = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â spark.className = 'hammer-lightning';
Â  Â  Â  Â  Â  Â  Â  Â  Â spark.style.left = (hammerObj.x + 200) + 'px'; // í•´ë¨¸ ì¤‘ì‹¬ë¶€
Â  Â  Â  Â  Â  Â  Â  Â  Â spark.style.top = (hammerObj.y + 200) + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â spark.style.transform = `rotate(${randBetween(-180, 180)}deg)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â gameArea.appendChild(spark);
Â  Â  Â  Â  Â  Â  Â  Â  Â setTimeout(() => spark.remove(), 300);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if(hammerObj.x > window.innerWidth + 400) { // í™”ë©´ ë°–ìœ¼ë¡œ ì¶©ë¶„íˆ ë‚˜ê°”ì„ ë•Œ
Â  Â  Â  Â  Â  Â  Â  Â  hammerObj.remove();
Â  Â  Â  Â  Â  Â  Â  Â  hammerObj = null;
Â  Â  Â  Â  Â  Â  Â  Â  gameArea.classList.remove('shake-screen');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const hRect = { left: hammerObj.x + 50, right: hammerObj.x + 350, top: hammerObj.y + 50, bottom: hammerObj.y + 350 };
Â  Â  Â  Â  Â  Â  Â  Â  obstacles.forEach(o => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!o.destroyed && o.x < window.innerWidth) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oRect = o.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(hRect.right > oRect.left && hRect.left < oRect.right) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x, window.innerHeight - parseFloat(o.style.bottom || 0) - 50);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  enemies.forEach(e => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!e.isDead && e.x < window.innerWidth) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eRect = e.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(hRect.right > eRect.left && hRect.left < eRect.right) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.isDead = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(e.x, e.y);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(currentSkin === 'jeonchan' && running) {
Â  Â  Â  Â  Â  Â  jeonchanTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(jeonchanTimer >= 15.0) {
Â  Â  Â  Â  Â  Â  Â  Â  triggerJeonchanLightning();
Â  Â  Â  Â  Â  Â  Â  Â  jeonchanTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(currentSkin === 'jieun' && running) {
Â  Â  Â  Â  Â  Â  if(activeEffects.summon <= 0) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  jieunNoelTimer += safeDelta;
Â  Â  Â  Â  Â  Â  Â  Â  if(jieunNoelTimer >= 40.0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activateJieunBuff();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jieunNoelTimer = 0;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(currentSkin === 'haeun' && running && !isBossBattle) {
Â  Â  Â  Â  Â  Â  if(!haeunShieldActive) {
Â  Â  Â  Â  Â  Â  Â  Â  haeunShieldTimer += safeDelta;
Â  Â  Â  Â  Â  Â  Â  Â  if(haeunShieldTimer >= 10.0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  haeunShieldActive = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  haeunShieldTimer = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createHaeunShield();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ğŸ›¡ï¸ ë³´í˜¸ë§‰ ìƒì„±");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  haeunLifeTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(haeunLifeTimer >= 25.0) {
Â  Â  Â  Â  Â  Â  Â  Â  haeunLifeTimer = 0;
Â  Â  Â  Â  Â  Â  Â  Â  if(life < maxLife) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  life++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("lifeText").innerText = life;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showHealEffect();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ğŸ’– ìƒëª…ë ¥ íšŒë³µ");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(currentSkin === 'jihye' && running) {
Â  Â  Â  Â  Â  Â  jihyePassiveTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(jihyePassiveTimer >= 25.0) {
Â  Â  Â  Â  Â  Â  Â  Â  triggerJihyeHeal();
Â  Â  Â  Â  Â  Â  Â  Â  jihyePassiveTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(currentSkin === 'jun' && running && !isJunTimeTravel) {
Â  Â  Â  Â  Â  Â  junLambTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(junLambTimer >= 30.0) {
Â  Â  Â  Â  Â  Â  Â  Â  spawnLamb();
Â  Â  Â  Â  Â  Â  Â  Â  junLambTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(currentSkin === 'noel' && running) {
Â  Â  Â  Â  Â  Â  noelGiantTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(noelGiantTimer >= 30.0) {
Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("âš¡ ì´ˆ ê±°ëŒ€í™”!");
Â  Â  Â  Â  Â  Â  Â  Â  activeEffects.giant = 10;Â 
Â  Â  Â  Â  Â  Â  Â  Â  player.style.transform = "scale(2)";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const aura = document.createElement('div'); aura.className = 'noel-aura';
Â  Â  Â  Â  Â  Â  Â  Â  player.appendChild(aura);
Â  Â  Â  Â  Â  Â  Â  Â  noelGiantTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(currentSkin === 'hahwi' && running) {
Â  Â  Â  Â  Â  Â  hahwiStoneTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(hahwiStoneTimer >= 30.0) {
Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ğŸ’ ì¸í”¼ë‹ˆí‹° ìŠ¤í†¤!");
Â  Â  Â  Â  Â  Â  Â  Â  for(let i=0; i<6; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const stone = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stone.className = 'infinity-stone';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const colors = ['red', 'orange', 'yellow', 'green', 'blue', 'purple'];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stone.style.color = colors[i%6];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stone.style.background = colors[i%6];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stone.angle = (i/6)*Math.PI*2;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stone.radius = 80;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stone.state = 'orbit';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const px = playerObj.x + 30; const py = window.innerHeight - playerObj.y - 30;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stone.style.left = px + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stone.style.top = py + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(stone);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infinityStones.push(stone);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  hahwiStoneTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(currentSkin === 'ganghui' && running) {
Â  Â  Â  Â  Â  Â  if(funnels.length === 0 && ganghuiPanelTimer === 0) spawnFunnel();
Â  Â  Â  Â  Â  Â  ganghuiPanelTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(ganghuiPanelTimer >= 10.0) {
Â  Â  Â  Â  Â  Â  Â  Â  spawnFunnel();
Â  Â  Â  Â  Â  Â  Â  Â  ganghuiPanelTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(currentSkin === 'yejun' && running) {
Â  Â  Â  Â  Â  Â  yejunCloneTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(yejunCloneTimer >= 50.0) {
Â  Â  Â  Â  Â  Â  Â  Â  triggerYejunClones();
Â  Â  Â  Â  Â  Â  Â  Â  yejunCloneTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(currentSkin === 'stephanie' && running) {
Â  Â  Â  Â  Â  Â  stephanieHeartTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(stephanieHeartTimer >= 30.0) {
Â  Â  Â  Â  Â  Â  Â  Â  if(life < maxLife) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  life++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("lifeText").innerText = life;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // [ìˆ˜ì • 9] ìŠ¤í…ŒíŒŒë‹ˆ í í…ìŠ¤íŠ¸ ì¶”ê°€
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ğŸ’– +1 Life");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const heart = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  heart.className = 'heart-emit'; heart.innerText = "â¤ï¸";
Â  Â  Â  Â  Â  Â  Â  Â  heart.style.left = (playerObj.x+15)+'px'; heart.style.top = (window.innerHeight - playerObj.y - 40)+'px';
Â  Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(heart);
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(()=>heart.remove(), 1000);
Â  Â  Â  Â  Â  Â  Â  Â  stephanieHeartTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(activeEffects.noelLaser > 0) {
Â  Â  Â  Â  Â  Â  const beam = document.getElementById('noelBeam');
Â  Â  Â  Â  Â  Â  if(beam) { beam.style.bottom = (playerObj.y - 20) + "px"; }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(activeEffects.jihyeSquad > 0) {
Â  Â  Â  Â  Â  Â  jihyeUnits.forEach(u => {
Â  Â  Â  Â  Â  Â  Â  Â  u.moveTimer += safeDelta;
Â  Â  Â  Â  Â  Â  Â  Â  if(u.moveTimer > 1.0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.tx = (window.innerWidth / 2) + randBetween(-200, 200);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.ty = (window.innerHeight / 2) + randBetween(-200, 200);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.moveTimer = 0;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  u.x += (u.tx - u.x) * 0.05;
Â  Â  Â  Â  Â  Â  Â  Â  u.y += (u.ty - u.y) * 0.05;
Â  Â  Â  Â  Â  Â  Â  Â  u.style.left = u.x + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  u.style.top = u.y + 'px';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  u.fireTimer += safeDelta;
Â  Â  Â  Â  Â  Â  Â  Â  if(u.fireTimer > 0.6) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const m = document.createElement('div'); m.className = 'jihye-missile';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.x = u.x + 25; m.y = u.y + 25; m.w=24; m.h=24;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.style.left = m.x + 'px'; m.style.top = m.y + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.vx = 700; m.vy = 0;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(m); jihyeMissiles.push(m);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  u.fireTimer = 0;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(infinityStones.length > 0) {
Â  Â  Â  Â  Â  Â  const px = playerObj.x + 30; const py = window.innerHeight - playerObj.y - 30;
Â  Â  Â  Â  Â  Â  for(let i=infinityStones.length-1; i>=0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  const s = infinityStones[i];
Â  Â  Â  Â  Â  Â  Â  Â  let sx = parseFloat(s.style.left);
Â  Â  Â  Â  Â  Â  Â  Â  let sy = parseFloat(s.style.top);

Â  Â  Â  Â  Â  Â  Â  Â  if(s.state === 'orbit') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  s.angle += 3 * safeDelta;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tx = px + Math.cos(s.angle) * s.radius - 12;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ty = py + Math.sin(s.angle) * s.radius - 12;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sx += (tx-sx)*0.1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sy += (ty-sy)*0.1;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let found = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let k=0; k<obstacles.length; k++){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!obstacles[k].destroyed && obstacles[k].x < window.innerWidth && !obstacles[k].isTargeted){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  found = obstacles[k]; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!found){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let k=0; k<enemies.length; k++){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!enemies[k].isDead && !enemies[k].isTargeted){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  found = enemies[k]; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(found) { s.target = found; found.isTargeted = true; s.state = 'attack'; }
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  else if(s.state === 'attack') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!s.target || s.target.destroyed || s.target.isDead) { s.state = 'return'; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tx = s.target.x + 30;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ty = s.target.y || (window.innerHeight - parseFloat(s.target.style.bottom || 0) - 50);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sx += (tx - sx) * 0.08;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sy += (ty - sy) * 0.08;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(Math.hypot(tx-sx, ty-sy) < 40) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(tx, ty);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(tx, ty, 5, false, false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(s.target.classList.contains('obstacle')) { s.target.destroyed = true; s.target.remove(); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else { s.target.isDead = true; s.target.remove(); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  s.state = 'return';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  else if(s.state === 'return') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sx += (px - sx) * 0.1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sy += (py - sy) * 0.1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(Math.hypot(px-sx, py-sy) < 50) s.state = 'orbit';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  s.style.left = sx + 'px'; s.style.top = sy + 'px';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(activeEffects.bobaTime > 0 && bobas.length > 0) {
Â  Â  Â  Â  Â  Â  const px = playerObj.x + 30; const py = window.innerHeight - playerObj.y - 30;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  bobas.forEach(b => {
Â  Â  Â  Â  Â  Â  Â  Â  let bx = parseFloat(b.style.left) || px;
Â  Â  Â  Â  Â  Â  Â  Â  let by = parseFloat(b.style.top) || py;

Â  Â  Â  Â  Â  Â  Â  Â  if(b.state === 'orbit') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  b.angle += 3 * safeDelta;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tx = px + Math.cos(b.angle) * b.radius - 9;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ty = py + Math.sin(b.angle) * b.radius - 9;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bx += (tx-bx)*0.1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  by += (ty-by)*0.1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let found = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let k=0; k<obstacles.length; k++){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!obstacles[k].destroyed && obstacles[k].x < window.innerWidth && !obstacles[k].isTargeted){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  found = obstacles[k]; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!found){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let k=0; k<enemies.length; k++){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!enemies[k].isDead && !enemies[k].isTargeted){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  found = enemies[k]; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(found) { b.target = found; found.isTargeted = true; b.state = 'attack'; }
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  else if(b.state === 'attack') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!b.target || b.target.destroyed || b.target.isDead) { b.state = 'return'; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tx = b.target.x + 30;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ty = b.target.y || (window.innerHeight - parseFloat(b.target.style.bottom || 0) - 50);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bx += (tx - bx) * 0.08;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  by += (ty - by) * 0.08;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(Math.hypot(tx-bx, ty-by) < 40) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(tx, ty);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(tx, ty, 5, false, false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(b.target.classList.contains('obstacle')) { b.target.destroyed = true; b.target.remove(); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else { b.target.isDead = true; b.target.remove(); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  b.state = 'return';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  else if(b.state === 'return') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bx += (px - bx) * 0.1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  by += (py - by) * 0.1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(Math.hypot(px-bx, py-by) < 50) b.state = 'orbit';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  b.style.left = bx + 'px'; b.style.top = by + 'px';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  funnels.forEach(f => {
Â  Â  Â  Â  Â  Â  f.x += (f.tx - f.x)*0.02;
Â  Â  Â  Â  Â  Â  f.y += (f.ty - f.y)*0.02;
Â  Â  Â  Â  Â  Â  f.style.left = f.x + 'px';
Â  Â  Â  Â  Â  Â  f.style.top = f.y + 'px';

Â  Â  Â  Â  Â  Â  if(Math.abs(f.tx - f.x) < 20) {
Â  Â  Â  Â  Â  Â  Â  Â  f.tx = randBetween(50, window.innerWidth-50);
Â  Â  Â  Â  Â  Â  Â  Â  f.ty = randBetween(50, window.innerHeight-50);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let crashed = false;
Â  Â  Â  Â  Â  Â  const fRect = {x: f.x, y: f.y, w: 40, h: 40};
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  for(let i=obstacles.length-1; i>=0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  if(crashed) break;
Â  Â  Â  Â  Â  Â  Â  Â  const o = obstacles[i];
Â  Â  Â  Â  Â  Â  Â  Â  const oY = window.innerHeight - parseFloat(o.style.bottom || 0) - (parseFloat(o.style.height));
Â  Â  Â  Â  Â  Â  Â  Â  const oRect = {x: o.x, y: oY, w: 60, h: parseFloat(o.style.height)};
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(!o.destroyed && isColliding(fRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true; o.remove(); obstacles.splice(i,1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(f.x, f.y);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  crashed = true;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(!crashed) {
Â  Â  Â  Â  Â  Â  Â  Â  for(let i=enemies.length-1; i>=0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const e = enemies[i];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eRect = {x: e.x, y: e.y, w: 60, h: 60};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!e.isDead && isColliding(fRect, eRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.isDead = true; e.remove(); enemies.splice(i,1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(f.x, f.y);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  crashed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(crashed) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  f.remove();Â 
Â  Â  Â  Â  Â  Â  Â  Â  funnels.splice(funnels.indexOf(f), 1);Â 
Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  f.timer += safeDelta;
Â  Â  Â  Â  Â  Â  if(f.timer > f.fireCD) {
Â  Â  Â  Â  Â  Â  Â  Â  const l = document.createElement('div'); l.className = 'funnel-laser';
Â  Â  Â  Â  Â  Â  Â  Â  l.style.left = (f.x + 20) + 'px'; l.style.top = (f.y+20) + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  l.style.width = '100vw';Â 
Â  Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(l);
Â  Â  Â  Â  Â  Â  Â  Â  l.animate([{opacity:1}, {opacity:0}], {duration:300}).onfinish = () => l.remove();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let hit = false;
Â  Â  Â  Â  Â  Â  Â  Â  obstacles.forEach(o => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oTop = window.innerHeight - parseFloat(o.style.bottom || 0) - parseFloat(o.style.height);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oBottom = window.innerHeight - parseFloat(o.style.bottom || 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!hit && oTop < f.y+60 && oBottom > f.y-20 && !o.destroyed && o.x < window.innerWidth) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x, oTop);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hit = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  enemies.forEach(e => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!hit && e.y < f.y+60 && e.y+60 > f.y-20 && !e.isDead) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.isDead = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(e.x, e.y);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hit = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  f.timer = 0; f.fireCD = 4.0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  yejunClones.forEach(c => {
Â  Â  Â  Â  Â  Â  c.el.x += c.vx;Â 
Â  Â  Â  Â  Â  Â  c.el.y += c.vy;

Â  Â  Â  Â  Â  Â  if(c.el.x < 0 || c.el.x > window.innerWidth) c.vx *= -1;
Â  Â  Â  Â  Â  Â  if(c.el.y < 20 || c.el.y > window.innerHeight) c.vy *= -1;

Â  Â  Â  Â  Â  Â  c.el.style.left = c.el.x + 'px';
Â  Â  Â  Â  Â  Â  c.el.style.bottom = c.el.y + 'px';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const cRect = {x: c.el.x, y: window.innerHeight - c.el.y - 50, w: 50, h: 50};
Â  Â  Â  Â  Â  Â  obstacles.forEach(o => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!o.destroyed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oY = window.innerHeight - parseFloat(o.style.bottom || 0) - parseFloat(o.style.height);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oRect = {x: o.x, y: oY, w: 60, h: parseFloat(o.style.height)};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isColliding(cRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x, oY);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  enemies.forEach(e => {
Â  Â  Â  Â  Â  Â  Â  Â  if(!e.isDead) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eRect = {x: e.x, y: e.y, w: 60, h: 60};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isColliding(cRect, eRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.isDead = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(e.x, e.y);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  c.fireTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(c.fireTimer > 0.8) {
Â  Â  Â  Â  Â  Â  Â  Â  const m = document.createElement("div"); m.classList.add("player-missile");
Â  Â  Â  Â  Â  Â  Â  Â  m.style.left = (c.el.x + 50) + 'px';Â 
Â  Â  Â  Â  Â  Â  Â  Â  m.style.top = (window.innerHeight - c.el.y - 20) + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(m); playerMissiles.push(m);
Â  Â  Â  Â  Â  Â  Â  Â  c.fireTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(activeEffects.cakeWorld > 0) {
Â  Â  Â  Â  Â  Â  cakeDropTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(cakeDropTimer > 0.3) {
Â  Â  Â  Â  Â  Â  Â  Â  const c = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  c.className = 'cake-item';
Â  Â  Â  Â  Â  Â  Â  Â  c.style.backgroundImage = `url('Cake${Math.ceil(Math.random()*3)}.png')`;
Â  Â  Â  Â  Â  Â  Â  Â  c.y = -60;
Â  Â  Â  Â  Â  Â  Â  Â  c.x = randBetween(50, window.innerWidth-50);
Â  Â  Â  Â  Â  Â  Â  Â  c.style.left = c.x + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  c.style.top = c.y + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  c.w = 60; c.h = 60;
Â  Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(c);
Â  Â  Â  Â  Â  Â  Â  Â  cakes.push(c);
Â  Â  Â  Â  Â  Â  Â  Â  cakeDropTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  for(let i=cakes.length-1; i>=0; i--) {
Â  Â  Â  Â  Â  Â  const c = cakes[i];
Â  Â  Â  Â  Â  Â  c.y += 300 * safeDelta;
Â  Â  Â  Â  Â  Â  c.style.top = c.y + 'px';
Â  Â  Â  Â  Â  Â  if(c.y > window.innerHeight) { c.remove(); cakes.splice(i,1); continue; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const cRect = {x: c.x, y: c.y, w: 60, h: 60};
Â  Â  Â  Â  Â  Â  let hit = false;
Â  Â  Â  Â  Â  Â  for(let j=obstacles.length-1; j>=0; j--) {
Â  Â  Â  Â  Â  Â  Â  Â  const o = obstacles[j];
Â  Â  Â  Â  Â  Â  Â  Â  const oY = window.innerHeight - parseFloat(o.style.bottom || 0) - parseFloat(o.style.height);
Â  Â  Â  Â  Â  Â  Â  Â  const oRect = {x: o.x, y: oY, w: 60, h: parseFloat(o.style.height)};
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(!o.destroyed && isColliding(cRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x, oY);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(o.x, oY, Math.floor(randBetween(1,6)), false, false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.remove(); obstacles.splice(j,1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hit = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(hit) { c.remove(); cakes.splice(i,1); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(musicWaveActive) {
Â  Â  Â  Â  Â  Â  musicNoteTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(musicNoteTimer > 0.2) {
Â  Â  Â  Â  Â  Â  Â  Â  const n = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  n.className = 'music-note';
Â  Â  Â  Â  Â  Â  Â  Â  n.innerText = ['â™ª', 'â™«', 'â™¬', 'â™©'][Math.floor(Math.random()*4)];
Â  Â  Â  Â  Â  Â  Â  Â  n.style.color = `hsl(${Math.random()*360}, 100%, 50%)`;
Â  Â  Â  Â  Â  Â  Â  Â  n.x = -30; n.y = randBetween(50, window.innerHeight-100);
Â  Â  Â  Â  Â  Â  Â  Â  n.w = 40; n.h = 40;
Â  Â  Â  Â  Â  Â  Â  Â  n.style.left = n.x + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  n.style.top = n.y + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(n);
Â  Â  Â  Â  Â  Â  Â  Â  musicNotes.push(n);
Â  Â  Â  Â  Â  Â  Â  Â  musicNoteTimer = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  for(let i=musicNotes.length-1; i>=0; i--) {
Â  Â  Â  Â  Â  Â  const n = musicNotes[i];
Â  Â  Â  Â  Â  Â  n.x += 400 * safeDelta;
Â  Â  Â  Â  Â  Â  n.style.left = n.x + 'px';
Â  Â  Â  Â  Â  Â  if(n.x > window.innerWidth) { n.remove(); musicNotes.splice(i,1); continue; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const nRect = {x: n.x, y: n.y, w: 40, h: 40};
Â  Â  Â  Â  Â  Â  let hit = false;
Â  Â  Â  Â  Â  Â  for(let j=obstacles.length-1; j>=0; j--) {
Â  Â  Â  Â  Â  Â  Â  Â  const o = obstacles[j];
Â  Â  Â  Â  Â  Â  Â  Â  const oY = window.innerHeight - parseFloat(o.style.bottom || 0) - parseFloat(o.style.height);
Â  Â  Â  Â  Â  Â  Â  Â  const oRect = {x: o.x, y: oY, w: 60, h: parseFloat(o.style.height)};
Â  Â  Â  Â  Â  Â  Â  Â  if(!o.destroyed && isColliding(nRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x, oY);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(o.x, oY, Math.floor(randBetween(1,6)), false, false);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.remove(); obstacles.splice(j,1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hit = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(!hit) {
Â  Â  Â  Â  Â  Â  Â  Â  for(let k=enemies.length-1; k>=0; k--) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const e = enemies[k];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eRect = {x: e.x, y: e.y, w: 60, h: 60};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!e.isDead && isColliding(nRect, eRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.isDead = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(e.x, e.y);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(e.x, e.y, Math.floor(randBetween(1,6)), false, false);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.remove(); enemies.splice(k,1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hit = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(hit) { n.remove(); musicNotes.splice(i,1); }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(jihyeMissiles.length > 0) {
Â  Â  Â  Â  Â  Â  for(let i=jihyeMissiles.length-1; i>=0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  const m = jihyeMissiles[i];
Â  Â  Â  Â  Â  Â  Â  Â  m.x += m.vx * safeDelta;
Â  Â  Â  Â  Â  Â  Â  Â  m.y += m.vy * safeDelta;
Â  Â  Â  Â  Â  Â  Â  Â  m.style.left = m.x + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  m.style.top = m.y + 'px';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(m.x > window.innerWidth || m.x < -50 || m.y < -50 || m.y > window.innerHeight + 50) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jihyeMissiles.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let hit = false;
Â  Â  Â  Â  Â  Â  Â  Â  const mRect = {x: m.x, y: m.y, w: 24, h: 24};
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  for(let j=obstacles.length-1; j>=0; j--) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const o = obstacles[j];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oY = window.innerHeight - parseFloat(o.style.bottom || 0) - parseFloat(o.style.height);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oRect = {x: o.x, y: oY, w: 60, h: parseFloat(o.style.height)};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!o.destroyed && isColliding(mRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x+30, oY+30);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(o.x, oY, 5, false, true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.remove(); obstacles.splice(j, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hit = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if(hit) { m.remove(); jihyeMissiles.splice(i, 1); }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(activeEffects.sandstorm > 0) {
Â  Â  Â  Â  Â  Â  Â const pX = playerObj.x; const pY = window.innerHeight - playerObj.y - playerObj.h;
Â  Â  Â  Â  Â  Â  Â obstacles.forEach(o => {
Â  Â  Â  Â  Â  Â  Â  Â  const oY = window.innerHeight - parseFloat(o.style.bottom || 0) - parseFloat(o.style.height);
Â  Â  Â  Â  Â  Â  Â  Â  const dist = Math.hypot(o.x - pX, oY - pY);
Â  Â  Â  Â  Â  Â  Â  Â  if(!o.destroyed && dist < 250) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dust = document.createElement('div'); dust.className = 'dust-effect';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dust.style.left = o.x+'px'; dust.style.top = oY+'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(dust); setTimeout(()=>dust.remove(), 600);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(o.x, oY, Math.floor(randBetween(1,6)), false, false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.remove();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!isBossBattle && !isJunTimeTravel && !junMiniGameActive) {Â 
Â  Â  Â  Â  Â  Â  let distMultiplier = (activeEffects.turbo > 0) ? 4 : 1;
Â  Â  Â  Â  Â  Â  distance += safeDelta * 1 * distMultiplier;
Â  Â  Â  Â  Â  Â  document.getElementById("distanceText").innerText = Math.floor(distance) + "m";
Â  Â  Â  Â  Â  Â  let progress = Math.min(distance / 3000, 1);
Â  Â  Â  Â  Â  Â  let speedMultiplier = 1 + (progress * 14);
Â  Â  Â  Â  Â  Â  let currentSpeed = BASE_SPEED * speedMultiplier;
Â  Â  Â  Â  Â  Â  if (activeEffects.slow > 0) currentSpeed *= 0.5;
Â  Â  Â  Â  Â  Â  if (activeEffects.turbo > 0) currentSpeed *= 2.0;Â 
Â  Â  Â  Â  Â  Â  gameSpeed = currentSpeed;
Â  Â  Â  Â  } else if (isJunTimeTravel) {
Â  Â  Â  Â  Â  Â  gameSpeed = BASE_SPEED * 10;
Â  Â  Â  Â  } else { gameSpeed = BASE_SPEED * 0.5; }

Â  Â  Â  Â  if (!isBossBattle && distance >= nextBossTrigger) { startBossBattle(); }
Â  Â  Â  Â  if (!isBossBattle && distance >= nextQuizDistance) { nextQuizDistance += 35; pauseForQuiz(); return; }

Â  Â  Â  Â  if (isBossBattle) { updateBoss(safeDelta); }
Â  Â  Â  Â  else if (!isJunTimeTravel && !junMiniGameActive) {Â 
Â  Â  Â  Â  Â  Â  obstacleTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if (obstacleTimer >= nextObstacleTime && (nextQuizDistance - distance > 2)) {
Â  Â  Â  Â  Â  Â  Â  Â  spawnObstacle(); obstacleTimer = 0;Â 
Â  Â  Â  Â  Â  Â  Â  Â  let sm = gameSpeed / BASE_SPEED;
Â  Â  Â  Â  Â  Â  Â  Â  nextObstacleTime = randBetween(1.8, 2.6) / (1 + (sm - 1) * 0.6);Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (nextObstacleTime < 0.2) nextObstacleTime = 0.2;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  enemySpawnTimer += safeDelta;
Â  Â  Â  Â  Â  Â  if(enemySpawnTimer > 2.5 && !isBossBattle) { spawnEnemyLogic(); enemySpawnTimer = 0; }
Â  Â  Â  Â  }

Â  Â  Â  Â  updateEnemies(safeDelta);Â 
Â  Â  Â  Â  updatePhysics(safeDelta);
Â  Â  Â  Â  updateFaithCoinsLogic(safeDelta);
Â  Â  Â  Â Â 
Â  Â  Â  Â  itemTimer += safeDelta;
Â  Â  Â  Â  if (itemTimer >= nextItemTime && !isJunTimeTravel) { spawnItem(); itemTimer = 0; nextItemTime = 8 + Math.random() * 4; }

Â  Â  Â  Â  for (let i = items.length - 1; i >= 0; i--) {
Â  Â  Â  Â  Â  Â  let it = items[i];
Â  Â  Â  Â  Â  Â  if (activeEffects.magnet > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const px = playerObj.x + 30; const py = window.innerHeight - playerObj.y - 30;
Â  Â  Â  Â  Â  Â  Â  Â  const ix = it.x + 24; const iy = it.y + 24;
Â  Â  Â  Â  Â  Â  Â  Â  const dx = px - ix; const dy = py - iy; const dist = Math.sqrt(dx*dx + dy*dy);
Â  Â  Â  Â  Â  Â  Â  Â  if(dist < 400) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  it.x += (dx/dist)*12;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  it.y += (dy/dist)*12;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  it.style.left = it.x + "px";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  it.style.top = it.y + "px";
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  it.x -= gameSpeed * safeDelta;
Â  Â  Â  Â  Â  Â  it.style.left = it.x + "px";
Â  Â  Â  Â  Â  Â  if (it.x < -60) { it.remove(); items.splice(i, 1); continue; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const iRect = {x: it.x, y: it.y, w: 48, h: 48};
Â  Â  Â  Â  Â  Â  const pRect = {x: playerObj.x, y: window.innerHeight - playerObj.y - playerObj.h, w: playerObj.w, h: playerObj.h};

Â  Â  Â  Â  Â  Â  if (isColliding(pRect, iRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  activateItem(it.dataset.type); it.remove(); items.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â  spawnParticles(it.x, it.y, 'item'); playSound('item');
Â  Â  Â  Â  Â  Â  Â  Â  if(!isFeverTime) feverGauge = Math.min(feverGauge + 10, MAX_FEVER);
Â  Â  Â  Â  Â  Â  Â  Â  saveProgress();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  let speedMult = (gameSpeed / BASE_SPEED);Â 
Â  Â  Â  Â  bg1X -= BG1_SPEED * speedMult * safeDelta;
Â  Â  Â  Â  bg2X -= BG2_SPEED * speedMult * safeDelta;
Â  Â  Â  Â  bg3X -= BG3_SPEED * speedMult * safeDelta;
Â  Â  Â  Â  bg1.style.backgroundPosition = `${bg1X}px 0`;
Â  Â  Â  Â  bg2.style.backgroundPosition = `${bg2X}px bottom`;
Â  Â  Â  Â  bg3.style.backgroundPosition = `${bg3X}px bottom`;
Â  Â  } catch(e) { console.error(e); }
Â  Â  requestAnimationFrame(gameLoop);
Â  }

Â  Â function updateFaithCoinsLogic(dt) {
Â  Â  Â  for(let i = faithCoins.length - 1; i >= 0; i--) {
Â  Â  Â  Â  Â  const coin = faithCoins[i]; coin.timer += dt;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if (coin.timer < 0.3) {Â 
Â  Â  Â  Â  Â  Â  Â  coin.x += coin.vx * dt * 2;Â 
Â  Â  Â  Â  Â  Â  Â  coin.y += coin.vy * dt * 2;Â 
Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  const targetX = playerObj.x + 30; const targetY = window.innerHeight - playerObj.y - 30;
Â  Â  Â  Â  Â  Â  Â  const dx = targetX - coin.x; const dy = targetY - coin.y;

Â  Â  Â  Â  Â  Â  Â  if (coin.isAutoCollect || !coin.isManual) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  if(coin.isAutoCollect) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coin.x += dx * 8 * dt;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coin.y += dy * 8 * dt;
Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coin.x -= gameSpeed * dt;
Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coin.x -= gameSpeed * dt;
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  if (Math.abs(dx) < 40 && Math.abs(dy) < 40) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  let gain = 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  if(collectionBuff && Math.random() < 0.1) gain = 2;

Â  Â  Â  Â  Â  Â  Â  Â  Â  faith += gain; daily.faith20 += gain;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("faithText").innerText = faith;
Â  Â  Â  Â  Â  Â  Â  Â  Â  playSound('item');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("+1 ì‹ ì•™ì‹¬");
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  coinCombo++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  coinComboTimer = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  if(coinCombo >= 5) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ëŒ€ë°•!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coinCombo = 0;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  coin.remove(); faithCoins.splice(i, 1); continue;
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if(coin.x < -50) {
Â  Â  Â  Â  Â  Â  Â  coin.remove(); faithCoins.splice(i, 1); continue;
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  coin.style.left = coin.x + "px"; coin.style.top = coin.y + "px";
Â  Â  Â  }
Â  }

Â  function spawnEnemyLogic() {
Â  Â  Â  let type = 0;
Â  Â  Â  if (distance >= 500) type = 5; else if (distance >= 450) type = 4;
Â  Â  Â  else if (distance >= 400) type = 3; else if (distance >= 300) type = 2;
Â  Â  Â  else if (distance >= 200) type = 1;
Â  Â  Â  if (type > 0 && Math.random() < 0.6) spawnEnemy(type);
Â  }

Â  function spawnEnemy(type) {
Â  Â  Â  const e = document.createElement("div"); e.classList.add("enemy");
Â  Â  Â  e.style.backgroundImage = `url('enemy${type}.png')`;Â 
Â  Â  Â  e.style.backgroundColor = 'transparent';Â 
Â  Â  Â  e.type = type; e.hp = 1; e.timer = 0; e.state = 'enter';Â 
Â  Â  Â  e.x = window.innerWidth + 50; e.y = randBetween(50, window.innerHeight - 150);
Â  Â  Â  e.style.left = e.x + "px"; e.style.top = e.y + "px";
Â  Â  Â  gameArea.appendChild(e); enemies.push(e);
Â  }

Â  function updateEnemies(dt) {
Â  Â  for (let i = enemies.length - 1; i >= 0; i--) {
Â  Â  Â  Â  let e = enemies[i]; e.timer += dt;

Â  Â  Â  Â  if(e.laserWarning) {
Â  Â  Â  Â  Â  Â  e.laserWarning.style.width = e.x + "px";
Â  Â  Â  Â  Â  Â  e.laserWarning.style.top = (e.y + 30) + "px";
Â  Â  Â  Â  }
Â  Â  Â  Â  if(e.laserBeam) {
Â  Â  Â  Â  Â  Â  e.laserBeam.style.width = e.x + "px";
Â  Â  Â  Â  Â  Â  e.laserBeam.style.top = (e.y + 15) + "px";
Â  Â  Â  Â  }

Â  Â  Â  Â  if (activeEffects.noelLaser > 0 && e.x < window.innerWidth) {
Â  Â  Â  Â  Â  Â  spawnExplosionEffect(e.x + 30, e.y + 30);
Â  Â  Â  Â  Â  Â  let count = 4 + e.type;Â 
Â  Â  Â  Â  Â  Â  spawnFaithCoins(e.x + 30, e.y + 30, count, true, false);Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showFloatText("ğŸ’¥ ë ˆì´ì € ë¶„ì‡„!");
Â  Â  Â  Â  Â  Â  e.isDead = true;
Â  Â  Â  Â  Â  Â  if(e.laserWarning) e.laserWarning.remove();
Â  Â  Â  Â  Â  Â  if(e.laserBeam) e.laserBeam.remove();
Â  Â  Â  Â  Â  Â  e.remove(); enemies.splice(i, 1);
Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (isFeverTime) {
Â  Â  Â  Â  Â  Â if (!e.feverTimer) e.feverTimer = 0;
Â  Â  Â  Â  Â  Â if (e.x < window.innerWidth) e.feverTimer += dt;
Â  Â  Â  Â  Â  Â if (e.feverTimer > 1.0) {
Â  Â  Â  Â  Â  Â  Â  Â spawnExplosionEffect(e.x + 30, e.y + 30);
Â  Â  Â  Â  Â  Â  Â  Â let count = 4 + e.type;Â 
Â  Â  Â  Â  Â  Â  Â  Â spawnFaithCoins(e.x + 30, e.y + 30, count, true, false);
Â  Â  Â  Â  Â  Â  Â  Â showFloatText("ğŸ’¥ ì êµ° ì„¬ë©¸!");
Â  Â  Â  Â  Â  Â  Â  Â e.isDead = true;
Â  Â  Â  Â  Â  Â  Â  Â if(e.laserWarning) e.laserWarning.remove();
Â  Â  Â  Â  Â  Â  Â  Â if(e.laserBeam) e.laserBeam.remove();
Â  Â  Â  Â  Â  Â  Â  Â e.remove(); enemies.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â continue;
Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  }

Â  Â  Â  Â  if(e.state === 'enter') {
Â  Â  Â  Â  Â  Â  e.x -= 100 * dt;
Â  Â  Â  Â  Â  Â  if (e.x < window.innerWidth - 150) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  e.state = 'attack';Â 
Â  Â  Â  Â  Â  Â  Â  Â  e.timer = 1.1;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else if (e.state === 'attack') {
Â  Â  Â  Â  Â  Â  if (e.type === 1) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (e.timer < 2.0) e.y += Math.sin(e.timer * 5) * 2;Â 
Â  Â  Â  Â  Â  Â  Â  Â  else e.x -= 300 * dt;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (e.type >= 2 && e.type <= 5) {
Â  Â  Â  Â  Â  Â  Â  Â  e.y += Math.sin(Date.now() / 400) * 1.5;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (e.type === 2 && e.timer > 1.0) { spawnEnemyProjectile(e.x, e.y + 30, 'single', e); e.timer = 0; }
Â  Â  Â  Â  Â  Â  else if (e.type === 3 && e.timer > 1.0) { spawnEnemyProjectile(e.x, e.y + 30, 'fan', e); e.timer = 0; }
Â  Â  Â  Â  Â  Â  else if (e.type === 4 && e.timer > 1.0) { spawnEnemyProjectile(e.x, e.y + 30, 'explode', e); e.timer = 0; }
Â  Â  Â  Â  Â  Â  else if (e.type === 5 && e.timer > 1.0 && !e.isFiring) { fireEnemyLaser(e); }Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  e.style.left = e.x + "px"; e.style.top = e.y + "px";
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (e.x < -100) {Â 
Â  Â  Â  Â  Â  Â  e.isDead = true;Â 
Â  Â  Â  Â  Â  Â  if(e.laserWarning) e.laserWarning.remove();
Â  Â  Â  Â  Â  Â  if(e.laserBeam) e.laserBeam.remove();
Â  Â  Â  Â  Â  Â  e.remove(); enemies.splice(i, 1);Â 
Â  Â  Â  Â  }
Â  Â  }
Â  }

Â  function spawnEnemyProjectile(x, y, pattern, ownerEnemy) {
Â  Â  Â  if(pattern === 'single') createProj(x, y, -200, 0, ownerEnemy);Â 
Â  Â  Â  else if (pattern === 'fan') { createProj(x, y, -300, 0, ownerEnemy); createProj(x, y, -280, 100, ownerEnemy); createProj(x, y, -280, -100, ownerEnemy); }
Â  Â  Â  else if (pattern === 'explode') { let p = createProj(x, y, -250, 0, ownerEnemy); p.isExplosive = true; }
Â  }

Â  function createProj(x, y, vx, vy, owner) {
Â  Â  Â  const p = document.createElement("div"); p.classList.add("projectile", "enemy-missile");
Â  Â  Â  p.style.left = x + "px"; p.style.top = y + "px"; p.x = x; p.y = y; p.vx = vx; p.vy = vy;
Â  Â  Â  if(owner) p.owner = owner;Â 
Â  Â  Â  gameArea.appendChild(p); projectiles.push(p); return p;
Â  }

Â  function fireEnemyLaser(e) {
Â  Â  Â  e.isFiring = true;Â 
Â  Â  Â  const warning = document.createElement("div"); warning.className = "enemy-laser-warning";
Â  Â  Â  warning.style.left = "0px"; warning.style.width = e.x + "px"; warning.style.top = (e.y + 30) + "px";
Â  Â  Â  gameArea.appendChild(warning);
Â  Â  Â  e.laserWarning = warning;Â 

Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  if(e.isDead) { warning.remove(); return; }Â 
Â  Â  Â  Â  Â  warning.remove(); e.laserWarning = null;
Â  Â  Â  Â  Â  const laser = document.createElement("div"); laser.className = "enemy-laser-beam";
Â  Â  Â  Â  Â  laser.style.left = "0px"; laser.style.width = e.x + "px"; laser.style.top = (e.y + 15) + "px";
Â  Â  Â  Â  Â  gameArea.appendChild(laser);
Â  Â  Â  Â  Â  e.laserBeam = laser;Â 
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  let duration = 0;
Â  Â  Â  Â  Â  let check = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  if(e.isDead) { clearInterval(check); laser.remove(); return; }

Â  Â  Â  Â  Â  Â  Â  duration += 0.1; let laserY = parseFloat(laser.style.top);
Â  Â  Â  Â  Â  Â  Â  if(Math.abs((window.innerHeight - playerObj.y) - laserY) < 30 && !invincible) damageLife();
Â  Â  Â  Â  Â  Â  Â  if(duration > 5.0) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(check);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  laser.remove();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  e.laserBeam = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.isFiring = false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.timer = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 2000);Â 
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }, 100);
Â  Â  Â  }, 1000);Â 
Â  }

Â  function spawnItem() {
Â  Â  const types = ['invincible', 'turbo', 'slow', 'faith'];
Â  Â  const images = { 'invincible': 'url("item_cross.png")', 'turbo': 'url("item_wings.png")', 'slow': 'url("item_wind.png")', 'faith': 'url("item_bible.png")' };
Â  Â  const item = document.createElement("div"); const type = types[Math.floor(Math.random() * types.length)];
Â  Â  item.classList.add("item"); item.dataset.type = type; item.style.backgroundImage = images[type];Â 
Â  Â  item.x = window.innerWidth + 50;Â 
Â  Â  item.y = randBetween(100, window.innerHeight - 150);
Â  Â  item.style.left = item.x + "px"; item.style.top = item.y + "px";
Â  Â  document.getElementById("gameArea").appendChild(item); items.push(item);
Â  }

Â  function activateItem(type) {
Â  Â  if(type === 'invincible') { activeEffects.invincible = 10; showFloatText("ğŸ›¡ï¸ ë¬´ì !"); }
Â  Â  else if(type === 'turbo') { activeEffects.turbo = 5; showFloatText("ğŸš€ í„°ë³´!"); }
Â  Â  else if(type === 'slow') { activeEffects.slow = 10; showFloatText("ğŸƒ ê°ì†"); }
Â  Â  else if(type === 'faith') {Â 
Â  Â  Â  Â  let gain = 10;
Â  Â  Â  Â  if(collectionBuff) gain = 11;
Â  Â  Â  Â  faith += gain; daily.faith20 += gain;Â 
Â  Â  Â  Â  updateDailyMissionUI(); showFloatText(`ğŸ“˜ Faith +${gain}`);Â 
Â  Â  }
Â  Â  document.getElementById("faithText").innerText = faith;
Â  }

Â  function startBossBattle() {
Â  Â  isBossBattle = true; bossLevel++; boss.maxHp = 6 + (bossLevel-1)*4; boss.hp = boss.maxHp;Â 
Â  Â  invincible = false;
Â  Â  if(isFeverTime) endFeverTime();
Â  Â Â 
Â  Â  player.style.left = "50px";Â 

Â  Â  showFloatText(`âš ï¸ BOSS LV.${bossLevel} WARNING!`);
Â  Â  const warning = document.getElementById('bossWarning'); warning.innerText = `âš ï¸ BOSS LV.${bossLevel}!!`;
Â  Â  warning.style.display = 'block'; setTimeout(() => warning.style.display = 'none', 3000);
Â  Â Â 
Â  Â  obstacles.forEach(o => o.remove()); obstacles = [];Â 
Â  Â  enemies.forEach(e => e.remove()); enemies = [];Â 
Â  Â Â 
Â  Â  bossContainer.style.display = 'block'; setTimeout(() => { bossContainer.style.right = '20px'; }, 100);
Â  Â  document.getElementById('dailyMissionBox').style.display = 'none'; saveProgress();
Â  }

Â  function updateBoss(delta) {
Â  Â  if (boss.hp <= 0) return;
Â  Â  boss.actionTimer += delta;
Â  Â  if (boss.state === 'idle') { boss.y += boss.vy; if (boss.y > 80 || boss.y < 20) boss.vy *= -1; bossContainer.style.top = boss.y + "%"; }
Â  Â  if (bossLevel >= 2 && boss.state === 'idle' && boss.actionTimer > 5.0 && Math.random() < 0.01) startBossDash();
Â  Â  if (bossLevel >= 3 && boss.state === 'idle' && boss.actionTimer > 7.0 && Math.random() < 0.01) startBossLaser();
Â  Â  boss.shootTimer += delta;
Â  Â  if (boss.state === 'idle' && boss.shootTimer > 2.0) { bossShoot(bossLevel, (1.0 + (bossLevel*0.2)) * 0.4); boss.shootTimer = 0; }
Â  }

Â  function startBossDash() {
Â  Â  boss.state = 'dash'; bossBody.classList.add('boss-charging'); showFloatText("ğŸ’¢ ëŒì§„ ì¤€ë¹„!");
Â  Â  setTimeout(() => {
Â  Â  Â  Â  bossBody.classList.remove('boss-charging'); bossBody.classList.add('boss-dashing');
Â  Â  Â  Â  bossContainer.style.transition = "right 0.4s ease-in";Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  bossContainer.style.right = (window.innerWidth - 100) + "px";Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  setTimeout(() => {Â 
Â  Â  Â  Â  Â  Â  const bossYPx = (100 - boss.y) / 100 * window.innerHeight;
Â  Â  Â  Â  Â  Â  if(playerObj.y > bossYPx - 100 && playerObj.y < bossYPx + 50) {
Â  Â  Â  Â  Â  Â  Â  Â  damageLife();Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, 200);

Â  Â  Â  Â  setTimeout(() => {Â 
Â  Â  Â  Â  Â  Â  bossContainer.style.transition = "right 0.8s ease-out";Â 
Â  Â  Â  Â  Â  Â  bossContainer.style.right = "20px"; bossBody.classList.remove('boss-dashing'); boss.state = 'idle'; boss.actionTimer = 0;Â 
Â  Â  Â  Â  }, 800);
Â  Â  }, 1000);
Â  }

Â  function startBossLaser() {
Â  Â  boss.state = 'laser'; showFloatText("âš¡ ë ˆì´ì € ì¶©ì „!");
Â  Â  setTimeout(() => {
Â  Â  Â  Â  const laser = document.createElement('div'); laser.className = 'boss-laser'; laser.style.top = (boss.y + 5) + "%"; laser.style.display = 'block'; gameArea.appendChild(laser);
Â  Â  Â  Â  let checkLaser = setInterval(() => {Â 
Â  Â  Â  Â  Â  Â  let laserH = (100 - boss.y) / 100 * window.innerHeight;Â 
Â  Â  Â  Â  Â  Â  if (Math.abs(playerObj.y - (window.innerHeight - laserH) - 50) < 40 && !invincible) damageLife();Â 
Â  Â  Â  Â  }, 50);
Â  Â  Â  Â  setTimeout(() => { clearInterval(checkLaser); laser.remove(); boss.state = 'idle'; boss.actionTimer = 0; }, 1000);
Â  Â  }, 1500);
Â  }

Â  function bossShoot(count, speedMult) {
Â  Â  for(let i=0; i<count; i++) {
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  const m = document.createElement("div"); m.classList.add("projectile", "boss-missile");
Â  Â  Â  Â  Â  Â  const rect = bossContainer.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  const startX = rect.left; const startY = rect.top + 30;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const pX = 120; const pY = window.innerHeight - playerObj.y - 30;
Â  Â  Â  Â  Â  Â  const dx = pX - startX; const dy = pY - startY; const dist = Math.sqrt(dx*dx + dy*dy);
Â  Â  Â  Â  Â  Â  const speed = 300 * speedMult;
Â  Â  Â  Â  Â  Â  const vx = (dx / dist) * speed; const vy = (dy / dist) * speed;
Â  Â  Â  Â  Â  Â  m.style.left = startX + "px"; m.style.top = startY + "px";
Â  Â  Â  Â  Â  Â  m.x = startX; m.y = startY; m.vx = vx; m.vy = vy; m.isBossMissile = true;Â 
Â  Â  Â  Â  Â  Â  gameArea.appendChild(m); projectiles.push(m);
Â  Â  Â  Â  }, i * 300);Â 
Â  Â  }
Â  }

Â  function damageBoss() {
Â  Â  boss.hp--; bossHpFill.style.width = (boss.hp / boss.maxHp * 100) + "%"; showFloatText("ğŸ’¥ ë³´ìŠ¤ íƒ€ê²©!");
Â  Â  if (boss.hp <= 0) {
Â  Â  Â  Â  bossContainer.style.transition = "top 1s ease-in"; bossContainer.style.top = "120%";Â 
Â  Â  Â  Â  spawnParticles(window.innerWidth-100, window.innerHeight-100, 'dust');
Â  Â  Â  Â  setTimeout(() => {Â 
Â  Â  Â  Â  Â  Â  bossContainer.style.display = 'none'; isBossBattle = false; invincible = false; activeEffects.invincible = 0; activeEffects.turbo = 0;
Â  Â  Â  Â  Â  Â  if(!daily.completed) document.getElementById('dailyMissionBox').style.display = 'block';
Â  Â  Â  Â  Â  Â  faith += 100 * bossLevel; daily.faith20 += 100; updateDailyMissionUI();
Â  Â  Â  Â  Â  Â  showFloatText(`ğŸ‰ ë³´ìŠ¤ ì²˜ì¹˜! (+${100*bossLevel} Faith)`); playSound('clear');
Â  Â  Â  Â  Â  Â  nextBossTrigger = distance + 200; saveProgress();Â 
Â  Â  Â  Â  }, 1000);
Â  Â  }
Â  }

Â  function updatePhysics(delta) {
Â  Â  if(isJunTimeTravel || junMiniGameActive) return;Â 

Â  Â  if (activeEffects.fly > 0) { playerObj.y += (targetY - playerObj.y) * 0.1; velocity = 0; if(speedLines) speedLines.style.display = "none"; }Â 
Â  Â  else if (activeEffects.turbo > 0) { velocity = 0; if(speedLines)
Â  Â  speedLines.style.display = "block"; }Â 
Â  Â  else { velocity += gravity; playerObj.y += velocity; if(speedLines) speedLines.style.display = "none"; }

Â  Â  if (playerObj.y < 0) playerObj.y = 0;
Â  Â  if (playerObj.y > window.innerHeight - 110) playerObj.y = window.innerHeight - 110;
Â  Â  player.style.bottom = playerObj.y + "px";

Â  Â  const safeActive = (val) => (val && val > 0);

Â  Â  for (let i = playerMissiles.length - 1; i >= 0; i--) {
Â  Â  Â  Â  let m = playerMissiles[i];
Â  Â  Â  Â  let mx = parseFloat(m.style.left);
Â  Â  Â  Â  mx += 600 * delta;Â 
Â  Â  Â  Â  m.style.left = mx + "px";
Â  Â  Â  Â  if (mx > window.innerWidth) { m.remove(); playerMissiles.splice(i, 1); continue; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const mRect = {x: mx, y: parseFloat(m.style.top), w: 50, h: 24};
Â  Â  Â  Â Â 
Â  Â  Â  Â  let hitObs = false;
Â  Â  Â  Â  for (let k = obstacles.length - 1; k >= 0; k--) {
Â  Â  Â  Â  Â  Â  Â let o = obstacles[k];
Â  Â  Â  Â  Â  Â  Â const oY = window.innerHeight - parseFloat(o.style.bottom || 0) - parseFloat(o.style.height);
Â  Â  Â  Â  Â  Â  Â const oRect = {x: o.x, y: oY, w: 60, h: parseFloat(o.style.height)};
Â  Â  Â  Â  Â  Â  Â if(!o.destroyed && isColliding(mRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â o.destroyed = true;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â spawnExplosionEffect(o.x, oY);
Â  Â  Â  Â  Â  Â  Â  Â  Â m.remove(); playerMissiles.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â o.remove(); obstacles.splice(k, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â hitObs = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â break;
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  }
Â  Â  Â  Â  if(hitObs) continue;

Â  Â  Â  Â  for (let j = enemies.length - 1; j >= 0; j--) {
Â  Â  Â  Â  Â  Â  let e = enemies[j];
Â  Â  Â  Â  Â  Â  const eRect = {x: e.x, y: e.y, w: 60, h: 60};
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isColliding(mRect, eRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  e.hp--; m.remove(); playerMissiles.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const ex = document.createElement('div'); ex.className = 'explosion-area';
Â  Â  Â  Â  Â  Â  Â  Â  ex.style.left = eRect.x + 'px'; ex.style.top = eRect.y + 'px'; ex.style.width='60px'; ex.style.height='60px';
Â  Â  Â  Â  Â  Â  Â  Â  gameArea.appendChild(ex); setTimeout(()=>ex.remove(), 500);

Â  Â  Â  Â  Â  Â  Â  Â  if (e.hp <= 0) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.isDead = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.laserWarning) e.laserWarning.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.laserBeam) e.laserBeam.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.remove(); enemies.splice(j, 1);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let count = 4 + e.type;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(e.x + 30, e.y + 30, count, true, false);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ğŸ’¥ ì êµ° ê²©íŒŒ! (+5)");Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!isFeverTime) feverGauge = Math.min(feverGauge + 5, MAX_FEVER);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  break;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  for (let i = projectiles.length - 1; i >= 0; i--) {
Â  Â  Â  Â  let p = projectiles[i];
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (p.owner && p.owner.isDead) {
Â  Â  Â  Â  Â  Â  p.style.opacity = (parseFloat(p.style.opacity) || 1) - 0.05;Â 
Â  Â  Â  Â  Â  Â  p.isFading = true;Â 
Â  Â  Â  Â  Â  Â  if (p.style.opacity <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  p.remove(); projectiles.splice(i, 1); continue;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  p.x += p.vx * delta; p.y += p.vy * delta;
Â  Â  Â  Â  p.style.left = p.x + "px"; p.style.top = p.y + "px";
Â  Â  Â  Â  if (p.x < -100 || p.x > window.innerWidth + 100 || p.y < -100 || p.y > window.innerHeight + 100) { p.remove(); projectiles.splice(i, 1); continue; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (p.isExplosive && !p.exploded && p.x <= 120) {Â 
Â  Â  Â  Â  Â  Â  Â p.exploded = true;
Â  Â  Â  Â  Â  Â  Â const boom = document.createElement("div"); boom.className = "explosion-area";
Â  Â  Â  Â  Â  Â  Â boom.style.width = "260px"; boom.style.height = "260px";Â 
Â  Â  Â  Â  Â  Â  Â boom.style.left = (p.x - 100) + "px"; boom.style.top = (p.y - 100) + "px";
Â  Â  Â  Â  Â  Â  Â gameArea.appendChild(boom); setTimeout(() => boom.remove(), 500);
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â const pRect = {x: playerObj.x, y: window.innerHeight - playerObj.y - playerObj.h, w: playerObj.w, h: playerObj.h};
Â  Â  Â  Â  Â  Â  Â const bRect = {x: p.x - 100, y: p.y - 100, w: 260, h: 260};

Â  Â  Â  Â  Â  Â  Â if (isColliding(pRect, bRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â if(!invincible && !safeActive(activeEffects.invincible)) damageLife();
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â p.remove(); projectiles.splice(i, 1); continue;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!p.isReflected && !p.isFading) {
Â  Â  Â  Â  Â  Â  const pRect = {x: playerObj.x, y: window.innerHeight - playerObj.y - playerObj.h, w: playerObj.w, h: playerObj.h};
Â  Â  Â  Â  Â  Â  const mRect = {x: p.x, y: p.y, w: 30, h: 30};
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isColliding(pRect, mRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  if (isFeverTime) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  p.remove(); projectiles.splice(i, 1); faith += 5; showFloatText("ğŸ’¥ ëŒíŒŒ!"); continue;Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  else if (!invincible && !safeActive(activeEffects.invincible) && !safeActive(activeEffects.summon)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  damageLife(); p.remove(); projectiles.splice(i, 1); continue;Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if (isBossBattle && p.isReflected) {
Â  Â  Â  Â  Â  Â  const bRect = bossContainer.getBoundingClientRect();Â 
Â  Â  Â  Â  Â  Â  const pRect = p.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  if (pRect.right > bRect.left && pRect.left < bRect.right && pRect.bottom > bRect.top && pRect.top < bRect.bottom) { damageBoss(); p.remove(); projectiles.splice(i, 1); continue; }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  for (let i = enemies.length - 1; i >= 0; i--) {
Â  Â  Â  Â  let e = enemies[i];
Â  Â  Â  Â  if (!safeActive(activeEffects.invincible) && !invincible) {
Â  Â  Â  Â  Â  Â  const pRect = {x: playerObj.x, y: window.innerHeight - playerObj.y - playerObj.h, w: playerObj.w, h: playerObj.h};
Â  Â  Â  Â  Â  Â  const eRect = {x: e.x, y: e.y, w: 60, h: 60};
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isColliding(pRect, eRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  if(activeEffects.giant > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â e.isDead = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.laserWarning) e.laserWarning.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.laserBeam) e.laserBeam.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.remove(); enemies.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(e.x + 30, e.y + 30, Math.floor(randBetween(1,6)), false, false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ğŸ’¥ ê±°ëŒ€í™” ê²©íŒŒ!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(e.x, e.y); continue;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (isFeverTime) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.isDead = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.laserWarning) e.laserWarning.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.laserBeam) e.laserBeam.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.remove(); enemies.splice(i, 1);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let count = 4 + e.type;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(e.x + 30, e.y + 30, count, true, false);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ğŸ’¥ ì êµ° ë¶„ì‡„! (+5)");Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(e.x, e.y); continue;Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  else { damageLife(); e.remove(); enemies.splice(i, 1); continue; }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  for (let i = obstacles.length - 1; i >= 0; i--) {
Â  Â  Â  Â  let o = obstacles[i];
Â  Â  Â  Â  o.x -= gameSpeed * delta;
Â  Â  Â  Â  o.style.left = o.x + "px";
Â  Â  Â  Â Â 
Â  Â  Â  Â  let rw = 60; if(o.classList.contains('obs-long')) rw = 240;
Â  Â  Â  Â  const oY = window.innerHeight - parseFloat(o.style.bottom || 0) - parseFloat(o.style.height);
Â  Â  Â  Â  const oRect = {x: o.x, y: oY, w: rw, h: parseFloat(o.style.height)};
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (activeEffects.noelLaser > 0 && !o.destroyed) {
Â  Â  Â  Â  Â  Â  const beam = document.getElementById('noelBeam');
Â  Â  Â  Â  Â  Â  if (beam) {
Â  Â  Â  Â  Â  Â  Â  Â  const bRect = {x: 170, y: window.innerHeight - playerObj.y - 120, w: window.innerWidth, h: 100};
Â  Â  Â  Â  Â  Â  Â  Â  if (isColliding(bRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x + 30, oY);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(o.x, window.innerHeight - 150, Math.floor(randBetween(10, 31)));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.remove(); obstacles.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ğŸ’° ëŒ€ë°•!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(activeEffects.giant > 0 && !o.destroyed) {
Â  Â  Â  Â  Â  Â  Â const pRect = {x: playerObj.x, y: window.innerHeight - playerObj.y - playerObj.h, w: playerObj.w, h: playerObj.h};
Â  Â  Â  Â  Â  Â  Â if (isColliding(pRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â spawnExplosionEffect(o.x + 30, oY);
Â  Â  Â  Â  Â  Â  Â  Â  Â spawnFaithCoins(o.x, window.innerHeight - 150, Math.floor(randBetween(1, 6)), false, false);
Â  Â  Â  Â  Â  Â  Â  Â  Â o.remove(); obstacles.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â showFloatText("ğŸ¦¶ ë°Ÿì•˜ë‹¤!");
Â  Â  Â  Â  Â  Â  Â  Â  Â continue;
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  }

Â  Â  Â  Â  if (isFeverTime && o.x < 180 && !o.destroyed) {
Â  Â  Â  Â  Â  Â  o.destroyed = true;Â 
Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x + 30, oY);
Â  Â  Â  Â  Â  Â  spawnFaithCoins(o.x, window.innerHeight - 150, Math.floor(randBetween(2, 6)));
Â  Â  Â  Â  Â  Â  o.remove(); obstacles.splice(i, 1);
Â  Â  Â  Â  Â  Â  showFloatText("ğŸ’° ê²©íŒŒ!");
Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (o.x + rw < 0) {
Â  Â  Â  Â  Â  Â  o.remove(); obstacles.splice(i, 1); obstacleSurviveCount++;
Â  Â  Â  Â  Â  Â  if(!isFeverTime) feverGauge = Math.min(feverGauge + 5, MAX_FEVER);
Â  Â  Â  Â  Â  Â  if (obstacleSurviveCount >= 5) {
Â  Â  Â  Â  Â  Â  Â  Â  combo++; faith++; daily.faith20++; saveData.faith = faith; document.getElementById("faithText").innerText = faith;
Â  Â  Â  Â  Â  Â  Â  Â  const ce = document.getElementById("comboEffect"); ce.style.display = "block"; ce.innerText = `COMBO +${combo}!`; setTimeout(() => ce.style.display = "none", 1000);
Â  Â  Â  Â  Â  Â  Â  Â  obstacleSurviveCount = 0; saveProgress(); updateDailyMissionUI();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (currentSkin === 'jieun' && activeEffects.summon > 0 && !o.destroyed) {
Â  Â  Â  Â  Â  Â  const sRect = {x: playerObj.x - 20, y: window.innerHeight - playerObj.y - playerObj.h - 20, w: playerObj.w + 40, h: playerObj.h + 40};
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isColliding(sRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x + 30, oY);
Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(o.x, window.innerHeight - 150, 3, false, true);
Â  Â  Â  Â  Â  Â  Â  Â  o.remove(); obstacles.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ğŸ’¥ íŒŒê´´!");
Â  Â  Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if (currentSkin === 'haeun' && haeunShieldActive && !o.destroyed) {
Â  Â  Â  Â  Â  Â  const sRect = {x: playerObj.x - 10, y: window.innerHeight - playerObj.y - playerObj.h - 10, w: playerObj.w + 20, h: playerObj.h + 20};
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isColliding(sRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  o.destroyed = true;
Â  Â  Â  Â  Â  Â  Â  Â  haeunShieldActive = false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  removeHaeunShield();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  spawnExplosionEffect(o.x + 30, oY);
Â  Â  Â  Â  Â  Â  Â  Â  let coins = Math.floor(randBetween(5, 11));
Â  Â  Â  Â  Â  Â  Â  Â  spawnFaithCoins(o.x, window.innerHeight - 150, coins, false, true);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  o.remove(); obstacles.splice(i, 1);
Â  Â  Â  Â  Â  Â  Â  Â  showFloatText("ğŸ›¡ï¸ ë°©ì–´ & íŒŒê´´!");
Â  Â  Â  Â  Â  Â  Â  Â  playSound('clear');
Â  Â  Â  Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!isFeverTime && !safeActive(activeEffects.invincible) && !invincible && !safeActive(activeEffects.summon) && !safeActive(activeEffects.turbo) && !(currentSkin === 'haeun' && haeunShieldActive)) {
Â  Â  Â  Â  Â  Â  const pRect = {x: playerObj.x, y: window.innerHeight - playerObj.y - playerObj.h, w: playerObj.w, h: playerObj.h};
Â  Â  Â  Â  Â  Â  if (isColliding(pRect, oRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  damageLife(); break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  if(currentSkin === 'stephanie' && o.x < 50 && !o.passed) { faith++; daily.faith20++; document.getElementById("faithText").innerText = faith; o.passed = true; }
Â  Â  }
Â  }

Â  function spawnObstacle() {Â 
Â  Â  if(!running) return;
Â  Â  if(activeEffects.turbo > 0 && !isFeverTime) return;

Â  Â  const randi = (min,max)=>Math.floor(Math.random()*(max-min))+min;

Â  Â  if (distance < 50) {
Â  Â  Â  Â  const type = (Math.random() < 0.5) ? 'obs-log' : 'obs-rock';
Â  Â  Â  Â  const sx = window.innerWidth + 80;
Â  Â  Â  Â  const b = document.createElement("div");
Â  Â  Â  Â  b.classList.add("obstacle", "obs-cap", "obs-ground", type);
Â  Â  Â  Â  b.style.height = randi(130, 360) + "px";Â 
Â  Â  Â  Â  b.x = sx; b.style.left = sx + "px"; b.style.bottom = "0";
Â  Â  Â  Â  gameArea.appendChild(b);
Â  Â  Â  Â  obstacles.push(b);
Â  Â  Â  Â  return;Â 
Â  Â  }

Â  Â  if(distance > 50 && Math.random() < 0.65) {
Â  Â  Â  Â  let cnt = (Math.random()<0.3)?2:1;
Â  Â  Â  Â  for(let k=0; k<cnt; k++) {
Â  Â  Â  Â  Â  Â  const b = document.createElement("div"); b.classList.add("obstacle", "obs-long");
Â  Â  Â  Â  Â  Â  b.x = window.innerWidth+80; b.style.left = b.x+"px";
Â  Â  Â  Â  Â  Â  b.style.height = "35px";
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let sh = window.innerHeight;
Â  Â  Â  Â  Â  Â  if(cnt===2) { if(k===0) b.style.bottom=randBetween(30, sh*0.35)+"px"; else b.style.bottom=randBetween(sh*0.55, sh*0.85)+"px"; }
Â  Â  Â  Â  Â  Â  else { let r=Math.random(); if(r<0.2) b.style.bottom="0px"; else if(r<0.4) b.style.top="0px"; else b.style.bottom=randBetween(50, sh-120)+"px"; }
Â  Â  Â  Â  Â  Â  gameArea.appendChild(b); obstacles.push(b);
Â  Â  Â  Â  }
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  const type = (Math.random()<0.5)?'obs-log':'obs-rock';
Â  Â  const sx = window.innerWidth+80;
Â  Â  if(Math.random()<0.5) {
Â  Â  Â  Â  const b = document.createElement("div"); b.classList.add("obstacle", "obs-cap", "obs-ground", type);
Â  Â  Â  Â  b.style.height=randi(90,220)+"px"; b.x=sx; b.style.left=sx+"px"; b.style.bottom="0";
Â  Â  Â  Â  gameArea.appendChild(b); obstacles.push(b);
Â  Â  } else {
Â  Â  Â  Â  let th=randi(120,260); let gap=randi(160,220); let bh=Math.max(80, window.innerHeight-th-gap);
Â  Â  Â  Â  const t = document.createElement("div"); t.classList.add("obstacle", "obs-cap", "obs-ceil", type);
Â  Â  Â  Â  t.style.height=th+"px"; t.x=sx; t.style.left=sx+"px"; t.style.top="0";
Â  Â  Â  Â  const b = document.createElement("div"); b.classList.add("obstacle", "obs-cap", "obs-ground", type);
Â  Â  Â  Â  b.style.height=bh+"px"; b.x=sx; b.style.left=sx+"px"; b.style.bottom="0";
Â  Â  Â  Â  gameArea.appendChild(t); obstacles.push(b); gameArea.appendChild(b); obstacles.push(b);
Â  Â  }
Â  }

Â  function damageLife() {
Â  Â  if(life <= 1 && currentSkin === 'jaeguk' && !jaegukRevivedOnce) {
Â  Â  Â  Â  jaegukRevivedOnce = true;
Â  Â  Â  Â  life = maxLife;
Â  Â  Â  Â  document.getElementById("lifeText").innerText = life;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const wing = document.createElement('div');
Â  Â  Â  Â  wing.className = 'angel-wing-effect';
Â  Â  Â  Â  gameArea.appendChild(wing);
Â  Â  Â  Â  setTimeout(() => wing.remove(), 2000);
Â  Â  Â  Â Â 
Â  Â  Â  Â  showFloatText("ğŸª½ ë¶€í™œ!");
Â  Â  Â  Â  playSound('item');
Â  Â  Â  Â  activeEffects.invincible = 3;Â 
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  if(activeEffects.revive > 0) { life=3; document.getElementById("lifeText").innerText=life; activeEffects.revive=0; activeEffects.invincible=3; showFloatText("ğŸ‘¼ ë¶€í™œ!"); return; }
Â  Â  if(activeEffects.turbo>0 && !isFeverTime) return;Â 
Â  Â  if(activeEffects.invincible>0 || invincible || !running) return;
Â  Â Â 
Â  Â  if(currentSkin === 'haeun' && haeunShieldActive) {
Â  Â  Â  Â  haeunShieldActive = false;
Â  Â  Â  Â  removeHaeunShield();
Â  Â  Â  Â  showFloatText("ğŸ›¡ï¸ ë°©ì–´ ì„±ê³µ!");
Â  Â  Â  Â  playSound('parry');
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  life--; document.getElementById("lifeText").innerText=life;
Â  Â  invincible=true; player.style.opacity="0.4"; setTimeout(()=>{invincible=false; player.style.opacity="1";},800);
Â  Â  playSound('hit');
Â  Â  if(life<=0) gameOver();
Â  }

Â  function showFloatText(text) { const r=player.getBoundingClientRect(); const e=document.createElement("div"); e.classList.add("float-text"); e.innerText=text; e.style.left=(r.left+10)+"px"; e.style.top=(r.top-20)+"px"; document.body.appendChild(e); setTimeout(()=>e.remove(),1000); }
Â  function startGameNow() {Â 
Â  Â  Â  document.getElementById("startGuide").style.display="none";Â 
Â  Â  Â  running=true;Â 
Â  Â  Â  lastTime=performance.now();Â 
Â  Â  Â  if(sounds['bgm']) sounds['bgm'].play().catch(e=>console.log("BGM Error:", e));
Â  Â  Â  requestAnimationFrame(gameLoop);Â 
Â  Â  Â  updateDailyMissionUI();Â 
Â  }
Â  Â Â 
Â  async function saveProgress() {Â 
Â  Â  saveData.faith = faith;Â 
Â  Â  try{
Â  Â  Â  Â  await fetch(API_URL,{
Â  Â  Â  Â  Â  Â  method:"POST",
Â  Â  Â  Â  Â  Â  headers: { "Content-Type": "text/plain" },
Â  Â  Â  Â  Â  Â  redirect: 'follow',
Â  Â  Â  Â  Â  Â  body:JSON.stringify({type:"save",id,saveData})
Â  Â  Â  Â  });
Â  Â  }catch(e){}Â 
Â  Â  localStorage.setItem("run_save",JSON.stringify(saveData));Â 
Â  }

Â  async function gameOver() {Â 
Â  Â  Â  if(rankingSaved)return;Â 
Â  Â  Â  running=false; invincible=true; player.style.opacity="0.4";Â 
Â  Â  Â  document.getElementById("finalDist").innerText=Math.floor(distance);Â 
Â  Â  Â  document.getElementById("gameOverModal").style.display="flex";Â 
Â  Â  Â  try{
Â  Â  Â  Â  Â  await fetch(API_URL,{
Â  Â  Â  Â  Â  Â  Â  method:"POST",
Â  Â  Â  Â  Â  Â  Â  headers: { "Content-Type": "text/plain" },
Â  Â  Â  Â  Â  Â  Â  redirect: 'follow',
Â  Â  Â  Â  Â  Â  Â  body:JSON.stringify({type:"updateRanking",id,name,distance:Math.floor(distance),message:""})
Â  Â  Â  Â  Â  });
Â  Â  Â  }catch(e){}Â 
Â  Â  Â  rankingSaved=true;Â 
Â  }

Â  async function confirmRanking() {Â 
Â  Â  Â  const msg=document.getElementById("rankMsg").value.trim();Â 
Â  Â  Â  try{
Â  Â  Â  Â  Â  await fetch(API_URL,{
Â  Â  Â  Â  Â  Â  Â  method:"POST",
Â  Â  Â  Â  Â  Â  Â  headers: { "Content-Type": "text/plain" },
Â  Â  Â  Â  Â  Â  Â  redirect: 'follow',
Â  Â  Â  Â  Â  Â  Â  body:JSON.stringify({type:"updateComment",id,message:msg})
Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  Â  alert("ë“±ë¡ì™„ë£Œ"); window.location.href="/TrapGame/menu.html";
Â  Â  Â  }catch(e){
Â  Â  Â  Â  Â  alert("ì˜¤ë¥˜"); window.location.href="/TrapGame/menu.html";
Â  Â  Â  }Â 
Â  }
Â  Â Â 
Â  async function pauseForQuiz() {
Â  Â  if (!running) return;
Â  Â  running = false; document.getElementById("loadingQuiz").style.display = "flex";
Â  Â  try {
Â  Â  Â  const res = await fetch(API_URL, {Â 
Â  Â  Â  Â  Â  method: "POST",Â 
Â  Â  Â  Â  Â  headers: { "Content-Type": "text/plain" },
Â  Â  Â  Â  Â  redirect: 'follow',
Â  Â  Â  Â  Â  body: JSON.stringify({ type: "getQuiz" })Â 
Â  Â  Â  });
Â  Â  Â  const txt = await res.text();
Â  Â  Â  document.getElementById("loadingQuiz").style.display = "none";
Â  Â  Â  if (txt === "noquiz") { running = true; lastTime = performance.now(); requestAnimationFrame(gameLoop); return; }
Â  Â  Â  const quiz = JSON.parse(txt);
Â  Â  Â  document.getElementById("quizQuestion").innerText = quiz.question;
Â  Â  Â  document.getElementById("btnA").innerText = "A) " + quiz.A;
Â  Â  Â  document.getElementById("btnB").innerText = "B) " + quiz.B;
Â  Â  Â  document.getElementById("btnC").innerText = "C) " + quiz.C;
Â  Â  Â  window.correctAnswer = quiz.answer;
Â  Â  Â  document.getElementById("quizModal").style.display = "flex";
Â  Â  } catch (err) {
Â  Â  Â  alert("í€´ì¦ˆ ë¡œë”© ì‹¤íŒ¨. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.");
Â  Â  }
Â  }

Â  function answerQuiz(sel) {
Â  Â  document.getElementById("quizModal").style.display = "none";
Â  Â  if (sel === window.correctAnswer) {
Â  Â  Â  const ef = document.getElementById("correctEffect");
Â  Â  Â  ef.style.display = "block"; setTimeout(() => (ef.style.display = "none"), 800);
Â  Â  Â  Â  Â  Â  faith += 5; saveData.faith = faith; document.getElementById("faithText").innerText = faith;
Â  Â  Â  daily.quiz3++; localStorage.setItem("dailyMission", JSON.stringify(daily)); saveProgress();
Â  Â  } else { damageLife(); }
Â  Â  if (life > 0) { running = true; lastTime = performance.now(); requestAnimationFrame(gameLoop); }
Â  }
Â Â 
Â  let lastT=0; document.addEventListener("touchend",e=>{const n=Date.now();if(n-lastT<300)e.preventDefault();lastT=n;},{passive:false});
</script>
</body>
