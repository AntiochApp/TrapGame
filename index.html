<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì•ˆë””ì˜¥ ì²­ë…„ë¶€ ê²Œì„ â€“ Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff">

<style>
  /* í°íŠ¸ ì •ì˜ */
  @font-face {
    font-family: 'DungGeunMo';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
    font-weight: normal;
    font-style: normal;
  }

  :root {
    --bg-overlay: rgba(60, 40, 20, 0.4);
    --panel-color: #fdf6e3;
    --border-color: #5d4037;
    --primary-color: #ff9800; /* ë°ì€ ì˜¤ë Œì§€ */
    --primary-shadow: #e65100;
    --text-color: #3e2723;
    --input-bg: #fffbf0;
  }

  * { box-sizing: border-box; }

  body {
    margin: 0; padding: 0; min-height: 100vh;
    display: flex; justify-content: center; align-items: center;
    /* ë°°ê²½ ì´ë¯¸ì§€ ìœ ì§€ */
    background: url("https://antiochapp.github.io/TrapGame/bg_sky.png") no-repeat center bottom;
    background-size: cover;
    background-attachment: fixed;
    font-family: 'DungGeunMo', monospace; /* í°íŠ¸ ë³€ê²½ */
    color: var(--text-color);
    overflow: hidden;
  }

  /* ë°°ê²½ì— í”½ì…€ íŒ¨í„´ ì¶”ê°€ë¡œ ë””í…Œì¼ ì—… */
  body::before {
    content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-image: 
      linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px);
    background-size: 20px 20px;
    z-index: -1;
    pointer-events: none;
  }

  /* ë©”ì¸ ì¹´ë“œ ë””ìì¸ (RPG ëŒ€í™”ì°½ ìŠ¤íƒ€ì¼) */
  .pixel-card {
    width: 90%; max-width: 420px;
    padding: 30px 24px;
    background: var(--panel-color);
    border: 4px solid var(--border-color);
    border-radius: 8px;
    /* 3D í”½ì…€ ê·¸ë¦¼ì íš¨ê³¼ */
    box-shadow: 
      inset 4px 4px 0px #ffffff,
      inset -4px -4px 0px #d7ccc8,
      8px 8px 0px rgba(0,0,0,0.3);
    position: relative;
    margin-top: 20px;
    /* ë‘¥ë‘¥ ë– ë‹¤ë‹ˆëŠ” ì• ë‹ˆë©”ì´ì…˜ */
    animation: float 3s ease-in-out infinite;
  }

  @keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
    100% { transform: translateY(0px); }
  }

  /* ìºë¦­í„° ì˜ì—­ */
  .deco-chars {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
    margin-top: -50px; /* ì¹´ë“œë¥¼ ëš«ê³  ë‚˜ì˜¨ ëŠë‚Œ */
  }

  .char-img {
    width: 64px; height: 64px; /* í¬ê¸° í™•ëŒ€ */
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    image-rendering: pixelated;
    filter: drop-shadow(4px 4px 0 rgba(0,0,0,0.2)); /* ìºë¦­í„° ê·¸ë¦¼ì */
    animation: bounce 0.8s infinite alternate cubic-bezier(0.5, 0.05, 1, 0.5);
  }
  
  .char-img:nth-child(1) { animation-delay: 0s; }
  .char-img:nth-child(2) { animation-delay: 0.2s; }
  .char-img:nth-child(3) { animation-delay: 0.4s; }

  .moses { background-image: url("pixel_moses.png"); } 
  .david { background-image: url("pixel_david.png"); }
  .peter { background-image: url("pixel_peter.png"); }

  @keyframes bounce {
    0% { transform: translateY(0); }
    100% { transform: translateY(-12px); }
  }

  /* íƒ€ì´í‹€ ìŠ¤íƒ€ì¼ ê°•í™” */
  .pixel-title {
    text-align: center; font-size: 36px; 
    margin: 10px 0 5px; 
    color: #5d4037;
    /* ê¸€ì ì…ì²´ íš¨ê³¼ */
    text-shadow: 3px 3px 0px #ffe0b2, 5px 5px 0px rgba(0,0,0,0.2);
    letter-spacing: 2px;
  }

  .pixel-sub {
    text-align: center; font-size: 16px; color: #8d6e63; margin-bottom: 30px;
    background: #fff; display: inline-block; padding: 4px 12px;
    border-radius: 20px; border: 2px dashed #bcaaa4;
    position: relative; left: 50%; transform: translateX(-50%);
  }

  label { 
    display: block; font-size: 16px; margin-top: 15px; margin-bottom: 8px; 
    color: var(--border-color);
    text-shadow: 1px 1px 0 #fff;
  }

  /* ì…ë ¥ì°½ ë””ìì¸ (ì½˜ì†” ëŠë‚Œ) */
  input {
    width: 100%; padding: 14px; 
    border: 3px solid #8d6e63;
    border-radius: 0; /* ê°ì§€ê²Œ */
    font-size: 18px; 
    background: var(--input-bg); 
    font-family: 'DungGeunMo', monospace;
    outline: none;
    box-shadow: inset 3px 3px 0 rgba(0,0,0,0.1);
    transition: all 0.2s;
  }
  input:focus { 
    border-color: var(--primary-color); 
    background: #fff;
    box-shadow: inset 3px 3px 0 rgba(255, 152, 0, 0.1), 0 0 10px rgba(255, 152, 0, 0.4); 
  }

  /* ë²„íŠ¼ ë””ìì¸ (ì•„ì¼€ì´ë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼) */
  .btn-main {
    width: 100%; padding: 16px; margin-top: 30px; 
    border: 3px solid #000; border-radius: 8px;
    background: var(--primary-color); 
    color: #fff; font-size: 20px; 
    cursor: pointer; 
    font-family: 'DungGeunMo', monospace;
    /* ë²„íŠ¼ ì…ì²´ê° */
    box-shadow: 
      inset 4px 4px 0 rgba(255,255,255,0.4),
      4px 4px 0 var(--primary-shadow),
      4px 4px 0 2px #000; /* í…Œë‘ë¦¬ í¬í•¨ ê·¸ë¦¼ì */
    transition: all 0.1s;
    position: relative;
    top: 0; left: 0;
  }
  
  .btn-main:active:not(:disabled) { 
    top: 4px; left: 4px;
    box-shadow: inset 4px 4px 0 rgba(0,0,0,0.2); /* ëˆŒë¦° íš¨ê³¼ */
  }
  
  .btn-main:disabled { 
    background: #9e9e9e; 
    box-shadow: none; 
    border-color: #555;
    cursor: not-allowed; top: 2px; left: 2px;
  }

  .link-row { 
    text-align: center; margin-top: 25px; 
    font-size: 14px; color: #795548; 
    background: rgba(255,255,255,0.5);
    padding: 8px; border-radius: 6px;
  }
  .link-btn {
    cursor: pointer; color: #d84315; 
    margin: 0 10px; display: inline-block;
    transition: transform 0.2s;
  }
  .link-btn:hover { 
    transform: scale(1.1); 
    text-shadow: 1px 1px 0 #fff; 
    text-decoration: none;
  }

  .hidden { display: none; }

  /* ìŠ¤í”¼ë„ˆ ë””ìì¸ ê°œì„  */
  .spinner {
    width: 30px; height: 30px; border: 5px solid #ffe0b2;
    border-top: 5px solid var(--primary-shadow); border-radius: 50%;
    margin: 20px auto 0; display: none; animation: spin 0.8s linear infinite;
  }
  @keyframes spin { 100% { transform: rotate(360deg); } }

  .shake { animation: shake 0.4s ease-in-out; }
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-8px); }
    75% { transform: translateX(8px); }
  }
</style>
</head>

<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">

<div class="pixel-card" id="loginBox">
  
  <div class="deco-chars">
    <div class="char-img moses"></div>
    <div class="char-img david"></div>
    <div class="char-img peter"></div>
  </div>

  <h1 class="pixel-title">Disciple Run</h1>
  <div class="pixel-sub">PRESS START TO PLAY</div>

  <label for="loginId">ID (ì•„ì´ë””)</label>
  <input id="loginId" type="text" autocomplete="username" placeholder="PLAYER ID">

  <label for="loginPw">PASSWORD (ì•”í˜¸)</label>
  <input id="loginPw" type="password" autocomplete="current-password" placeholder="******" onkeypress="handleEnter(event, login)">

  <button class="btn-main" onclick="login()" id="loginBtn">GAME START</button>
  <div id="loginSpinner" class="spinner"></div>

  <div class="link-row">
    <span class="link-btn" onclick="showSignup()">ğŸ“ íšŒì›ê°€ì…</span>
    <span class="link-btn" onclick="showFindPw()">ğŸ” ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</span>
  </div>
</div>

<div class="pixel-card hidden" id="signupBox">
  <h1 class="pixel-title">NEW PLAYER</h1>
  <div class="pixel-sub">ë‚˜ë§Œì˜ ì‹ ì•™ ì—¬ì • ì‹œì‘í•˜ê¸°</div>

  <label for="newId">ID</label>
  <input id="newId" type="text" placeholder="ì‚¬ìš©í•  ì•„ì´ë””">

  <label for="newPw">PASSWORD</label>
  <input id="newPw" type="password" placeholder="ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸">

  <label for="newName">NAME (ì´ë¦„)</label>
  <input id="newName" type="text" placeholder="ë³¸ëª… (ë­í‚¹ í‘œì‹œìš©)">

  <label for="newBible">FAVORITE (ì„±ê²½ ì¸ë¬¼)</label>
  <input id="newBible" type="text" placeholder="ì˜ˆ: ë‹¤ìœ—, ë°”ìš¸">

  <button class="btn-main" onclick="signup()" id="signupBtn">JOIN NOW</button>
  <div id="signupSpinner" class="spinner"></div>

  <div class="link-row">
    <span class="link-btn" onclick="showLogin()">â†© BACK TO TITLE</span>
  </div>
</div>

<div class="pixel-card hidden" id="findPwBox">
  <h1 class="pixel-title">RECOVERY</h1>
  <div class="pixel-sub">ê³„ì • ì •ë³´ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?</div>

  <label for="findName">NAME (ì´ë¦„)</label>
  <input id="findName" type="text">

  <label for="findBible">FAVORITE (ì„±ê²½ ì¸ë¬¼)</label>
  <input id="findBible" type="text" onkeypress="handleEnter(event, findPw)">

  <button class="btn-main" onclick="findPw()" id="findPwBtn">SEARCH</button>
  <div id="findPwSpinner" class="spinner"></div>

  <div class="link-row">
    <span class="link-btn" onclick="showLogin()">â†© BACK TO TITLE</span>
  </div>
</div>

<script>
  // [ë³´ì•ˆ] F12 ë° ê°œë°œì ë„êµ¬ ë‹¨ì¶•í‚¤ ì°¨ë‹¨ (ê¸°ëŠ¥ ìœ ì§€)
  document.addEventListener('keydown', function(e) {
    if (e.key === 'F12' || 
       (e.ctrlKey && e.shiftKey && e.key === 'I') || 
       (e.ctrlKey && e.shiftKey && e.key === 'J') || 
       (e.ctrlKey && e.key === 'U')) {
      e.preventDefault();
      alert("ë³´ì•ˆì„ ìœ„í•´ ê°œë°œì ë„êµ¬ ì‚¬ìš©ì´ ì œí•œë©ë‹ˆë‹¤.");
    }
  });

  const API_URL = "https://script.google.com/macros/s/AKfycbzA10H2TuXRDXBXcttvHHR0Q1sOu8zGpYmrdGhfH-wBsl623k2ydwUkwL7wR8F90mC5Pg/exec";

  const loginBox  = document.getElementById("loginBox");
  const signupBox = document.getElementById("signupBox");
  const findPwBox = document.getElementById("findPwBox");

  function handleEnter(e, func) {
    if (e.key === "Enter") func();
  }

  function showSignup() {
    clearInputs();
    loginBox.classList.add("hidden");
    signupBox.classList.remove("hidden");
    findPwBox.classList.add("hidden");
  }
  function showFindPw() {
    clearInputs();
    loginBox.classList.add("hidden");
    signupBox.classList.add("hidden");
    findPwBox.classList.remove("hidden");
  }
  function showLogin() {
    clearInputs();
    loginBox.classList.remove("hidden");
    signupBox.classList.add("hidden");
    findPwBox.classList.add("hidden");
  }

  function clearInputs() {
    document.querySelectorAll("input").forEach(el => el.value = "");
  }

  // ë¡œê·¸ì¸
  async function login() {
    const idInput = document.getElementById("loginId");
    const pwInput = document.getElementById("loginPw");
    const id = idInput.value.trim();
    const pw = pwInput.value.trim();
    const btn = document.getElementById("loginBtn");
    const spinner = document.getElementById("loginSpinner");

    if (!id || !pw) {
      alert("IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    btn.disabled = true;
    spinner.style.display = "block";

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        // [ìˆ˜ì •] í†µì‹  ì•ˆì •ì„± í™•ë³´ (Apps Scriptìš© í•„ìˆ˜ ì˜µì…˜)
        headers: { "Content-Type": "text/plain" },
        redirect: 'follow',
        body: JSON.stringify({ type: "login", id, password: pw })
      });

      const txt = await res.text();

      if (txt === "fail") {
        alert("ë¡œê·¸ì¸ ì‹¤íŒ¨!\nID í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
        loginBox.classList.add("shake");
        setTimeout(() => loginBox.classList.remove("shake"), 400);
      } else {
        const data = JSON.parse(txt);
        localStorage.setItem("run_id", id);
        localStorage.setItem("run_name", data.name);
        localStorage.setItem("run_bible", data.bible);
        localStorage.setItem("run_save", JSON.stringify(data.saveData));
        window.location.href = "/TrapGame/menu.html";
      }
    } catch (e) {
      console.error(e);
      alert("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    }

    btn.disabled = false;
    spinner.style.display = "none";
  }

  // íšŒì›ê°€ì…
  async function signup() {
    const id = document.getElementById("newId").value.trim();
    const pw = document.getElementById("newPw").value.trim();
    const name = document.getElementById("newName").value.trim();
    const bible = document.getElementById("newBible").value.trim();

    if (!id || !pw || !name || !bible) {
      alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }

    const btn = document.getElementById("signupBtn");
    const spinner = document.getElementById("signupSpinner");

    btn.disabled = true;
    spinner.style.display = "block";

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        // [ìˆ˜ì •] í†µì‹  ì•ˆì •ì„± í™•ë³´
        headers: { "Content-Type": "text/plain" },
        redirect: 'follow',
        body: JSON.stringify({ type: "signup", id, password: pw, name, bible })
      });
      
      const txt = await res.text();
      
      if(txt === "exist") {
        alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” IDì…ë‹ˆë‹¤.");
      } else {
        alert("íšŒì›ê°€ì… í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‰\nì´ì œ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
        showLogin();
      }
    } catch (e) {
      alert("íšŒì›ê°€ì… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }

    btn.disabled = false;
    spinner.style.display = "none";
  }

  // ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
  async function findPw() {
    const name = document.getElementById("findName").value.trim();
    const bible = document.getElementById("findBible").value.trim();

    if (!name || !bible) {
      alert("ì´ë¦„ê³¼ ì¢‹ì•„í•˜ëŠ” ì„±ê²½ ì¸ë¬¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    const btn = document.getElementById("findPwBtn");
    const spinner = document.getElementById("findPwSpinner");
    
    btn.disabled = true;
    spinner.style.display = "block";

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        // [ìˆ˜ì •] í†µì‹  ì•ˆì •ì„± í™•ë³´
        headers: { "Content-Type": "text/plain" },
        redirect: 'follow',
        body: JSON.stringify({ type: "findPw", name, bible })
      });

      const txt = await res.text();

      if (txt === "notfound") {
        alert("ì¼ì¹˜í•˜ëŠ” ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      } else {
        const data = JSON.parse(txt);
        alert(`[ì •ë³´ í™•ì¸]\nID: ${data.id}\nPW: ${data.password}`);
      }
    } catch (e) {
      alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }

    btn.disabled = false;
    spinner.style.display = "none";
  }
</script>

</body>
</html>
